"use strict";(()=>{var ht=Object.create;var ue=Object.defineProperty,pt=Object.defineProperties,ft=Object.getOwnPropertyDescriptor,mt=Object.getOwnPropertyDescriptors,Et=Object.getOwnPropertyNames,be=Object.getOwnPropertySymbols,vt=Object.getPrototypeOf,Ne=Object.prototype.hasOwnProperty,gt=Object.prototype.propertyIsEnumerable;var Re=(t,e,n)=>e in t?ue(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,J=(t,e)=>{for(var n in e||(e={}))Ne.call(e,n)&&Re(t,n,e[n]);if(be)for(var n of be(e))gt.call(e,n)&&Re(t,n,e[n]);return t},B=(t,e)=>pt(t,mt(e));var te=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var _t=(t,e,n,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Et(e))!Ne.call(t,s)&&s!==n&&ue(t,s,{get:()=>e[s],enumerable:!(i=ft(e,s))||i.enumerable});return t};var yt=(t,e,n)=>(n=t!=null?ht(vt(t)):{},_t(e||!t||!t.__esModule?ue(n,"default",{value:t,enumerable:!0}):n,t));var he=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)};var H=(t,e,n)=>(he(t,e,"read from private field"),n?n.call(t):e.get(t)),C=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},q=(t,e,n,i)=>(he(t,e,"write to private field"),i?i.call(t,n):e.set(t,n),n);var L=(t,e,n)=>(he(t,e,"access private method"),n);var pe=te(p=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0});p.Events=p.ChannelReceiver=p.SystemSender=p.ErrorTypes=p.ChannelState=p.ClientActions=p.ServerActions=p.PresenceEventTypes=void 0;var Fe;(function(t){t.JOIN="JOIN",t.LEAVE="LEAVE",t.UPDATE="UPDATE"})(Fe||(p.PresenceEventTypes=Fe={}));var Oe;(function(t){t.PRESENCE="PRESENCE",t.SYSTEM="SYSTEM",t.BROADCAST="BROADCAST",t.ERROR="ERROR"})(Oe||(p.ServerActions=Oe={}));var Ue;(function(t){t.JOIN_CHANNEL="JOIN_CHANNEL",t.LEAVE_CHANNEL="LEAVE_CHANNEL",t.BROADCAST="BROADCAST"})(Ue||(p.ClientActions=Ue={}));var ke;(function(t){t.IDLE="IDLE",t.JOINING="JOINING",t.JOINED="JOINED",t.STALLED="STALLED",t.CLOSED="CLOSED"})(ke||(p.ChannelState=ke={}));var We;(function(t){t.UNAUTHORIZED_CONNECTION="UNAUTHORIZED_CONNECTION",t.UNAUTHORIZED_JOIN_REQUEST="UNAUTHORIZED_JOIN_REQUEST",t.UNAUTHORIZED_BROADCAST="UNAUTHORIZED_BROADCAST",t.INVALID_MESSAGE="INVALID_MESSAGE",t.HANDLER_NOT_FOUND="HANDLER_NOT_FOUND",t.PRESENCE_ERROR="PRESENCE_ERROR",t.CHANNEL_ERROR="CHANNEL_ERROR",t.ENDPOINT_ERROR="ENDPOINT_ERROR",t.INTERNAL_SERVER_ERROR="INTERNAL_SERVER_ERROR"})(We||(p.ErrorTypes=We={}));var xe;(function(t){t.ENDPOINT="ENDPOINT",t.CHANNEL="CHANNEL"})(xe||(p.SystemSender=xe={}));var Ve;(function(t){t.ALL_USERS="ALL_USERS",t.ALL_EXCEPT_SENDER="ALL_EXCEPT_SENDER"})(Ve||(p.ChannelReceiver=Ve={}));var Ge;(function(t){t.ACKNOWLEDGE="ACKNOWLEDGE"})(Ge||(p.Events=Ge={}))});var Ee=te(E=>{"use strict";var K=E&&E.__classPrivateFieldSet||function(t,e,n,i,s){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?s.call(t,n):s?s.value=n:e.set(t,n),n},g=E&&E.__classPrivateFieldGet||function(t,e,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(t):i?i.value:e.get(t)},D,A,M,P;Object.defineProperty(E,"__esModule",{value:!0});E.BehaviorSubject=E.Subject=E.SimpleBehaviorSubject=E.SimpleSubject=void 0;var $=class{constructor(){D.set(this,void 0),K(this,D,new Set,"f")}subscribe(e){return g(this,D,"f").add(e),()=>g(this,D,"f").delete(e)}publish(e){g(this,D,"f").forEach(n=>n(e))}get size(){return g(this,D,"f").size}};E.SimpleSubject=$;D=new WeakMap;var fe=class extends ${constructor(e){super(),A.set(this,void 0),K(this,A,e,"f")}get value(){return g(this,A,"f")}publish(e){K(this,A,e,"f"),super.publish(e)}subscribe(e){return g(this,A,"f")&&e(g(this,A,"f")),super.subscribe(e)}};E.SimpleBehaviorSubject=fe;A=new WeakMap;var ne=class extends ${constructor(){super(...arguments),M.set(this,{})}subscribeWith(e,n){g(this,M,"f")[e]=super.subscribe(n)}unsubscribe(e){var n,i;(i=(n=g(this,M,"f"))[e])===null||i===void 0||i.call(n),delete g(this,M,"f")[e]}has(e){return!!g(this,M,"f")[e]}};E.Subject=ne;M=new WeakMap;var me=class extends ne{constructor(e){super(),P.set(this,void 0),K(this,P,e,"f")}subscribeWith(e,n){g(this,P,"f")&&n(g(this,P,"f")),super.subscribeWith(e,n)}publish(e){K(this,P,e,"f"),super.publish(e)}};E.BehaviorSubject=me;P=new WeakMap});var Ke=te(S=>{"use strict";var y=S&&S.__classPrivateFieldSet||function(t,e,n,i,s){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?s.call(t,n):s?s.value=n:e.set(t,n),n},c=S&&S.__classPrivateFieldGet||function(t,e,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(t):i?i.value:e.get(t)},v,w,z,O,U,f,b,I,Z,ie,se,ve,F,qe,Je;Object.defineProperty(S,"__esModule",{value:!0});S.Channel=void 0;var d=pe(),Be=Ee(),ge=class{constructor(e,n,i,s,a={}){v.add(this),w.set(this,void 0),z.set(this,void 0),O.set(this,void 0),U.set(this,void 0),f.set(this,void 0),b.set(this,void 0),I.set(this,void 0),Z.set(this,void 0),ie.set(this,void 0),y(this,w,i,"f"),y(this,I,[],"f"),y(this,Z,[],"f"),y(this,z,a,"f"),y(this,b,e,"f"),y(this,U,n,"f"),y(this,O,new Be.SimpleSubject,"f"),y(this,f,new Be.SimpleBehaviorSubject(d.ChannelState.IDLE),"f"),y(this,ie,c(this,v,"m",qe).call(this,s),"f")}join(){if(c(this,f,"f").value===d.ChannelState.CLOSED)throw new Error("This channel has been closed");let e={action:d.ClientActions.JOIN_CHANNEL,channelName:c(this,w,"f"),event:d.ClientActions.JOIN_CHANNEL,payload:c(this,z,"f")};c(this,f,"f").publish(d.ChannelState.JOINING),c(this,U,"f").value?c(this,b,"f").call(this,e):c(this,f,"f").publish(d.ChannelState.STALLED)}leave(){let e={action:d.ClientActions.LEAVE_CHANNEL,channelName:c(this,w,"f"),event:d.ClientActions.LEAVE_CHANNEL,payload:{}};c(this,v,"m",ve).call(this,e),c(this,f,"f").publish(d.ChannelState.CLOSED),c(this,ie,"f").call(this)}onMessage(e){return c(this,O,"f").subscribe(n=>{if(n.action!==d.ServerActions.PRESENCE)return e(n.event,n.payload)})}onMessageEvent(e,n){return this.onMessage((i,s)=>{if(i===e)return n(s)})}onChannelStateChange(e){return c(this,f,"f").subscribe(n=>{e(n)})}onJoin(e){return c(this,v,"m",F).call(this,(n,i)=>{if(n===d.PresenceEventTypes.JOIN)return e(i.changed)})}onLeave(e){return c(this,v,"m",F).call(this,(n,i)=>{if(n===d.PresenceEventTypes.LEAVE)return e(i.changed)})}onPresenceChange(e){return c(this,v,"m",F).call(this,(n,i)=>{if(n===d.PresenceEventTypes.UPDATE)return e(i)})}sendMessage(e,n,i){c(this,v,"m",se).call(this,e,n,i)}broadcastFrom(e,n){c(this,v,"m",se).call(this,e,n,d.ChannelReceiver.ALL_EXCEPT_SENDER)}broadcast(e,n){c(this,v,"m",se).call(this,e,n)}get channelState(){return c(this,f,"f").value}getPresence(){return c(this,Z,"f")}onUsersChange(e){return c(this,v,"m",F).call(this,(n,i)=>e(i.presence))}isConnected(){return c(this,f,"f").value===d.ChannelState.JOINED||c(this,f,"f").value===d.ChannelState.STALLED}onConnectionChange(e){return this.onChannelStateChange(n=>{e(n===d.ChannelState.JOINED||n===d.ChannelState.STALLED)})}};S.Channel=ge;w=new WeakMap,z=new WeakMap,O=new WeakMap,U=new WeakMap,f=new WeakMap,b=new WeakMap,I=new WeakMap,Z=new WeakMap,ie=new WeakMap,v=new WeakSet,se=function(e,n,i=d.ChannelReceiver.ALL_USERS){let s={action:d.ClientActions.BROADCAST,channelName:c(this,w,"f"),event:e,payload:n,addresses:i};c(this,v,"m",ve).call(this,s)},ve=function(e){if(c(this,U,"f").value){c(this,f,"f").value===d.ChannelState.JOINED&&c(this,b,"f").call(this,e);return}c(this,I,"f").push(e)},F=function(e){return c(this,O,"f").subscribe(n=>{if(n.action===d.ServerActions.PRESENCE)return e(n.event,n.payload)})},qe=function(e){let n=e.subscribe(a=>{a.channelName===c(this,w,"f")&&(a.event===d.Events.ACKNOWLEDGE?(c(this,f,"f").publish(d.ChannelState.JOINED),c(this,v,"m",Je).call(this)):c(this,O,"f").publish(a))}),i=c(this,U,"f").subscribe(a=>{if(a&&c(this,f,"f").value===d.ChannelState.STALLED){let r={action:d.ClientActions.JOIN_CHANNEL,channelName:c(this,w,"f"),event:d.ClientActions.JOIN_CHANNEL,payload:c(this,z,"f")};c(this,b,"f").call(this,r)}else!a&&c(this,f,"f").value===d.ChannelState.JOINED&&c(this,f,"f").publish(d.ChannelState.STALLED)}),s=c(this,v,"m",F).call(this,(a,r)=>{y(this,Z,r.presence,"f")});return()=>{n(),i(),s()}},Je=function(){c(this,I,"f").filter(e=>e.action!==d.ClientActions.JOIN_CHANNEL).forEach(e=>{c(this,b,"f").call(this,e)}),c(this,f,"f").publish(d.ChannelState.JOINED),y(this,I,[],"f")}});var Xe=te(R=>{"use strict";var $e=R&&R.__classPrivateFieldSet||function(t,e,n,i,s){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?s.call(t,n):s?s.value=n:e.set(t,n),n},k=R&&R.__classPrivateFieldGet||function(t,e,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(t):i?i.value:e.get(t)},_e,T,Ze;Object.defineProperty(R,"__esModule",{value:!0});var Ht=Ke(),Mt=pe(),ze=Ee(),ye=class{constructor(e,n={}){_e.add(this),T.set(this,void 0);let i;try{i=new URL(e)}catch(r){i=new URL(window.location.toString()),i.pathname=e}let s=new URLSearchParams(n);i.search=s.toString();let a=i.protocol==="https:"?"wss:":"ws:";i.protocol!=="wss:"&&i.protocol!=="ws:"&&(i.protocol=a),this._address=i,$e(this,T,{},"f"),this._broadcaster=new ze.SimpleSubject,this._connectionState=new ze.SimpleBehaviorSubject(!1)}connect(e=1){let n=new WebSocket(this._address.toString());n.onopen=()=>{this._connectionState.publish(!0)},n.onmessage=i=>{let s=JSON.parse(i.data);this._broadcaster.publish(s)},n.onerror=()=>{this._connectionState.publish(!1),setTimeout(()=>{this.connect(e*2)},e*1e3)},this._socket=n}getState(){return this._connectionState.value}disconnect(){var e;Object.values(k(this,T,"f")).forEach(n=>n.leave()),(e=this._socket)===null||e===void 0||e.close(),$e(this,T,{},"f")}createChannel(e,n){if(k(this,T,"f")[e]&&k(this,T,"f")[e].channelState!==Mt.ChannelState.CLOSED)return k(this,T,"f")[e];let i=k(this,_e,"m",Ze).call(this),s=new Ht.Channel(i,this._connectionState,e,this._broadcaster,n);return k(this,T,"f")[e]=s,s}onConnectionChange(e){return this._connectionState.subscribe(e)}};T=new WeakMap,_e=new WeakSet,Ze=function(){return e=>{this._connectionState.value&&this._socket.send(JSON.stringify(e))}};R.default=ye});var h=(t,e,n)=>{let i=new CustomEvent(t,{detail:e,bubbles:!0,cancelable:!0});n?n.dispatchEvent(i):window.dispatchEvent(i)},He=(t,e)=>{t.broadcastFrom("event",e)},Me=(t,e,n)=>{t.broadcastFrom(e,n)};var Ct=t=>{t.onAttributeChange("[pond-value]",(e,n,i)=>{let s=e;s.value=i||""})},Lt=t=>{t.onAttributeChange("[pond-checked]",(e,n,i)=>{let s=e;s.checked=i==="true"})},Tt=t=>{t.onAttributeChange("[pond-disabled]",(e,n,i)=>{let s=e;s.disabled=i==="true"})},wt=t=>{t.onAttributeChange("[pond-hidden]",(e,n,i)=>{let s=e;s.hidden=i==="true"})},St=t=>{t.onAttributeChange("[pond-readonly]",(e,n,i)=>{let s=e;s.readOnly=i==="true"})},Dt=t=>{t.onAttributeChange("[pond-required]",(e,n,i)=>{let s=e;s.required=i==="true"})},At=t=>{t.onAttributeChange("[pond-focused]",(e,n,i)=>{let s=e;i==="true"?s.focus():s.blur()})},bt=t=>{t.onAttributeChange("[pond-copy]",(e,n,i)=>{let s=e;s.value=i||"",navigator.clipboard.writeText(s.value).catch(console.error)})},Rt=t=>{t.onAttributeChange("[pond-emit]",(e,n,i)=>{try{let s=JSON.parse(i||"{}");h("pond-emit",s,e)}catch(s){h("pond-emit",i,e)}})},Pe=t=>{Ct(t),Lt(t),Tt(t),wt(t),St(t),Dt(t),At(t),Rt(t),bt(t)};var Nt=async(t,e,n,i,s)=>{s.preventDefault();let a=e.replace(/[\[\].#]/g,""),r=i.getAttribute(a),o=i.getAttribute("pond-data-id");if(r){let l=await n(s,i,r);l&&(l.event?Me(t,l.event,B(J({},l),{dataId:o,action:r,address:window.location.toString()})):He(t,B(J({},l),{dataId:o,action:r,address:window.location.toString()})))}},Ie=(t,e)=>(n,i,s)=>{e.addEventListener(n,i,async(a,r)=>{await Nt(t,n,s,a,r)})};var nt=yt(Xe());var ae=t=>typeof t=="function",Le=t=>Array.isArray(t),Ce=t=>t instanceof Date,Pt=t=>typeof t=="object"&&t!==null&&!Le(t)&&!Ce(t),X=t=>!Pt(t)&&!Le(t),W=t=>t!=null,It=t=>Object.keys(t).length===0,Qe=(t,e)=>{let n=(s,a)=>s===a||Ce(s)&&Ce(a)&&s.getTime()===a.getTime()?"unchanged":s===void 0?"created":a===void 0?"deleted":"updated",i=(s,a)=>{if(ae(s)||ae(a))throw new Error("Invalid argument. Function given, object expected.");if(X(s)||X(a)){let o=n(s,a);return o==="updated"?{type:o,data:a}:{type:o,data:s===void 0?a:s}}let r={};for(let o in s){if(ae(s[o]))continue;let l;a[o]!==void 0&&(l=a[o]),r[o]=i(s[o],l)}for(let o in a)ae(a[o])||r[o]!==void 0||(r[o]=i(void 0,a[o]));return r};return i(t,e)},Te=t=>{let e={};for(let n in t)if(t[n]){if(t[n].type==="created"||t[n].type==="updated")e[n]=t[n].data;else if(t[n].type==="deleted")e[n]=null;else if(typeof t[n]=="object"){let i=Te(t[n]);W(i)&&!It(i)&&(e[n]=i)}}return e};function Ft(t,e){let n=t.map((i,s)=>W(e[s])?re(i,e[s]):e[s]===null?void 0:i);for(let i in e)n[i]===void 0&&W(e[i])&&(n[i]=e[i]);return n.filter(i=>W(i))}function Ot(t,e){let n={};for(let i in t)if(e[i]!==void 0&&e[i]!==null)if(X(e[i]))n[i]=e[i];else{let s=re(t[i],e[i]);W(s)&&(n[i]=s)}else n[i]=t[i];for(let i in e)n[i]===void 0&&W(e[i])&&(n[i]=e[i]);return n}var re=(t,e)=>{if(t===void 0)return e;if(e===void 0)return t;if(e!==null)return X(t)&&X(e)?e:Le(t)?Ft(t,e):Ot(t,e)};var je={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},Ut=new RegExp(Object.keys(je).join("|"),"g"),_=class{constructor(e,n){this.statics=e,this.dynamics=n}static parse(e){let n=e,i=n.s||[""];delete n.s;let s=Object.values(n).filter(a=>a!=null);return new _(i,s)}toString(){let e=this.statics[0];for(let n=0;n<this.dynamics.length;n++)this.dynamics[n]instanceof _?e+=this.dynamics[n].toString()+this.statics[n+1]:Array.isArray(this.dynamics[n])?e+=oe(this.dynamics[n],"").toString()+this.statics[n+1]:typeof this.dynamics[n]=="object"?e+=this.parsedHtmlToString(this.dynamics[n])+this.statics[n+1]:e+=Ye(this.dynamics[n])+this.statics[n+1];return e}getParts(){let e={s:this.statics};for(let n=0;n<this.dynamics.length;n++)this.dynamics[n]instanceof _?e[n]=this.dynamics[n].getParts():Array.isArray(this.dynamics[n])?e[n]=oe(this.dynamics[n],"").getParts():this.dynamics[n]===void 0?e[n]=null:e[n]=this.dynamics[n];return e}parsedHtmlToString(e){var s;let n=e,i="";if(Array.isArray(n))return oe(n,"").toString();if(((s=n==null?void 0:n.s)==null?void 0:s.length)>0){let a=n.s.filter(r=>r!=null);i=n.s[0];for(let r=0;r<a.length-1;r++)typeof n[r]=="object"?i+=this.parsedHtmlToString(e[r])+n.s[r+1]:i+=Ye(e[r])+n.s[r+1]}return i}differentiate(e){let n=e.getParts(),i=this.getParts(),s=Qe(i,n);return Te(s)}patch(e){let n=re(this.getParts(),e);return _.parse(n)}};function oe(t,e){return t.length<=0?new _([""],[]):new _(["",...Array(t.length-1).fill(e),""],t)}function Ye(t){return t==null?"":t instanceof _?t.toString():Array.isArray(t)?oe(t,"").toString():String(t).replace(Ut,e=>je[e])}var kt=(t,e)=>{let n=t.childNodes;for(let i=n.length-1;i>=e;i--)n[i].remove()};function et(t,e){if(t instanceof Text&&e instanceof Text&&t.textContent!==e.textContent){t.replaceWith(e.cloneNode(!0));return}if(t instanceof Text&&e instanceof Element){t.replaceWith(e.cloneNode(!0));return}if(t instanceof Element&&e instanceof Text){t.replaceWith(e.cloneNode(!0));return}if(t.tagName!==e.tagName){t.replaceWith(e.cloneNode(!0));return}for(let i in e.attributes){let s=e.attributes[i];s&&s.name&&s.value&&(!t.hasAttribute(s.name)||t.getAttribute(s.name)!==s.value)&&t.setAttribute(s.name,s.value)}for(let i in t.attributes){let s=t.attributes[i];s&&s.name&&s.value&&(e.hasAttribute(s.name)?e.hasAttribute(s.name)&&e.getAttribute(s.name)!==s.value&&t.setAttribute(s.name,e.getAttribute(s.name)):t.removeAttribute(s.name))}let n=Math.max(t.childNodes.length,e.childNodes.length);for(let i=0;i<n;i++){let s=t.childNodes[i],a=e.childNodes[i];if(s&&a)et(s,a);else{if(s)return kt(t,i);a&&t.appendChild(a.cloneNode(!0))}}}function tt(t){let e=document.createElement("div"),n=document.getElementById("app");if(!n)throw new Error("App element not found");e.innerHTML=t.trim(),e.setAttribute("id","app"),et(n,e)}var Q,x,N,ce,it,Y,we,Se=class{constructor(e,n,i){C(this,ce);C(this,Y);C(this,Q,void 0);C(this,x,void 0);C(this,N,void 0);q(this,Q,i),q(this,x,e),q(this,N,n)}get channel(){return H(this,x)}static connect(e,n,i){var l;let s=new nt.default("/live");s.connect();let a=s.createChannel(`/${e}`,{address:window.location.toString()});a.join();let r=_.parse(i),o=new Se(a,r,e);return L(l=o,ce,it).call(l,n),o}async navigateTo(e,n=!0){let i={"Content-Type":"application/json",Accept:"application/json",["x-pond-live-router"]:"true",["x-pond-live-user-id"]:H(this,Q)},s=await fetch(e,{headers:i,method:"GET",redirect:"follow",credentials:"same-origin"});if(n){try{let a=await s.json();L(this,Y,we).call(this,a)}catch(a){console.error(a)}history.pushState(null,"",e),h("navigate-end",{url:e})}}},le=Se;Q=new WeakMap,x=new WeakMap,N=new WeakMap,ce=new WeakSet,it=function(e){H(this,x).onMessage((n,i)=>{if(n==="update")L(this,Y,we).call(this,i);else if(n==="live-event"){let{event:s,data:a}=i;h(s,a)}}),e.delegateEvent("a","click",async(n,i)=>{i.preventDefault();let a=n.href;h("navigate-start",{url:a}),await this.navigateTo(a)})},Y=new WeakSet,we=function(e){var n,i;if(e.diff&&(q(this,N,H(this,N).patch(e.diff)),tt(H(this,N).toString())),e["x-pond-live-page-title"]&&(document.title=e["x-pond-live-page-title"]),e["x-pond-live-router-action"])switch(e["x-pond-live-router-action"]){case"reload":window.location.reload();break;case"get-cookie":this.navigateTo((n=e.address)!=null?n:"",!1);break;case"update":break;case"navigate":this.navigateTo((i=e.address)!=null?i:"");break;default:break}};var at=(t,e,n)=>{let i=new XMLHttpRequest;return i.open("POST",t),i.setRequestHeader("x-pond-live-router","true"),i.setRequestHeader("x-pond-live-user-id",e),i.onreadystatechange=()=>{if(i.readyState===4&&i.status===200){let s=JSON.parse(i.responseText);h("pond-upload-success",s,n)}else h("pond-upload-error",i.responseText,n)},i.onloadstart=()=>h("pond-upload-start",{}),i.onloadend=()=>h("pond-upload-end",{}),i.onprogress=s=>{s.lengthComputable&&h("pond-upload-progress",{progress:Math.round(s.loaded/s.total*100)},n)},i},rt=(t,e="/")=>new Promise(n=>{if(t.isFile)t.file(s=>{let a=`${e}${s.name}`;n([{path:a,file:s}])});else if(t.isDirectory){let i=t,s=i.createReader(),a=[];s.readEntries(async r=>{for(let o=0;o<r.length;o++){let l=r[o],u=`${e}${i.name}/`,m=await rt(l,u);a.push(...m)}n(a)})}}),Wt=t=>{let e=[];if(!t)return e;for(let n=0;n<t.length;n++)e.push({path:`/${t[n].name}`,file:t[n]});return e},xt=t=>new Promise(async e=>{let n=[];for(let a=0;a<t.length;a++){let r=t[a].webkitGetAsEntry();r&&n.push(r)}let i=n.map(a=>rt(a)),s=await Promise.all(i);e(s.flat())}),st=t=>t.map(e=>({name:e.path,size:e.file.size,mimeType:e.file.type,path:e.path,file:e.file,lastModified:e.file.lastModified,lastModifiedDate:new Date(e.file.lastModified)}));async function Vt(t){if(t instanceof FileList)return st(Wt(t));if(t instanceof DataTransferItemList){let e=await xt(t);return st(e)}return[]}function Gt(t,e,n,i){let s=`${t.name}-${Math.random().toString(36).substring(2,15)}`,a=i(s,r=>{if(r.accepted||h("pond-upload-error",r.message),!r.route){h("pond-upload-error","No route provided");return}let o=at(r.route,n,e),l=new FormData;l.append(t.path,t.file,t.name),o.send(l)});return B(J({},t),{file:t.file,unsubscribe:a,identifier:s})}async function V(t,e,n,i){let s=await Vt(t),a=s.map(l=>Gt(l,e,n,i)),r=`${Math.random().toString(36).substring(2,15)}`;return i(r,l=>{if(l.accepted||h("pond-upload-error",l.message),!l.route){h("pond-upload-error","No route provided");return}a.forEach(G=>G.unsubscribe());let u=at(l.route,n,e),m=new FormData;s.forEach(G=>m.append(G.path,G.file,G.name)),u.send(m)}),{files:a.map(l=>({name:l.path,size:l.file.size,mimeType:l.file.type,path:l.path,lastModified:l.file.lastModified,identifier:l.identifier,lastModifiedDate:new Date(l.file.lastModified)})),identifier:r}}var Jt=t=>{t("[pond-focus]","focus",(e,n)=>({value:null,dataId:n.getAttribute("pond-data-id")}))},Bt=t=>{t("[pond-blur]","blur",(e,n)=>({value:null,dataId:n.getAttribute("pond-data-id")}))},qt=t=>{t("[pond-change]","change",(e,n)=>{let i=e.target,s=n.getAttribute("pond-data-id");return{value:i.value,dataId:s}})},Kt=t=>{t("[pond-input]","input",(e,n)=>({value:n.value,dataId:n.getAttribute("pond-data-id")}))},$t=t=>{t("[pond-check]","change",(e,n)=>{let i=n.getAttribute("pond-data-id");return{value:n.checked?"on":"off",dataId:i}})},zt=t=>{t("[pond-submit]","submit",(e,n)=>{e.preventDefault();let i=n.querySelectorAll("input, select, textarea"),s={};return i.forEach((a,r)=>{s[a.getAttribute("name")||`${r}`]=a.value}),{value:null,formData:s,dataId:n.getAttribute("pond-data-id")}})},Zt=(t,e,n)=>{t("[pond-file]","change",async(i,s)=>{let r=s.files;return r?{value:null,files:await V(r,s,e,n)}:null})},ot=(t,e,n)=>{Jt(t),Bt(t),qt(t),Kt(t),zt(t),$t(t),Zt(t,n,e)};var Xt=t=>{t("[pond-keydown]","keydown",e=>({value:e.target.value}))},Qt=t=>{t("[pond-keyup]","keyup",e=>({value:e.target.value}))},Yt=t=>{t("[pond-keypress]","keypress",e=>({value:e.target.value}))},lt=t=>{Xt(t),Qt(t),Yt(t)};var jt=t=>{t("[pond-click]","click",()=>({value:null}))},en=t=>{t("[pond-mouseenter]","mouseenter",()=>({value:null}))},tn=t=>{t("[pond-mouseleave]","mouseleave",()=>({value:null}))},nn=t=>{t("[pond-mousemove]","mousemove",()=>({value:null}))},sn=t=>{t("[pond-mousedown]","mousedown",()=>({value:null}))},an=t=>{t("[pond-mouseup]","mouseup",()=>({value:null}))},rn=t=>{t("[pond-double-click]","dblclick",()=>({value:null}))},on=t=>{t("[pond-context-menu]","contextmenu",()=>({value:null}))},ln=t=>{t("[pond-drag-start]","dragstart",(e,n)=>{let i=n.getBoundingClientRect();return{value:null,dragData:{top:i.top,left:i.left,width:i.width,height:i.height}}})},cn=t=>{t("[pond-drag-end]","dragend",(e,n)=>{let i=n.getBoundingClientRect();return{value:null,dragData:{top:i.top,left:i.left,width:i.width,height:i.height}}})},dn=t=>{t("[pond-drag-over]","dragover",(e,n)=>{let i=n.getBoundingClientRect();return{value:null,dragData:{top:i.top,left:i.left,width:i.width,height:i.height}}})},un=t=>{t("[pond-drag-enter]","dragenter",(e,n)=>{let i=n.getBoundingClientRect();return{value:null,dragData:{top:i.top,left:i.left,width:i.width,height:i.height}}})},hn=t=>{t("[pond-drag-leave]","dragleave",(e,n)=>{let i=n.getBoundingClientRect();return{value:null,dragData:{top:i.top,left:i.left,width:i.width,height:i.height}}})},pn=(t,e,n)=>{t("[pond-drop]","drop",async(i,s)=>{var u;i.preventDefault();let a=(u=i.dataTransfer)==null?void 0:u.items,r=s.getBoundingClientRect(),o={top:r.top,left:r.left,width:r.width,height:r.height},l;return a&&(l=await V(a,s,n,e)),{value:null,files:l,dragData:o}})},fn=(t,e,n)=>{t("[pond-upload]","submit",async(i,s)=>{i.preventDefault();let r=s.querySelector('input[type="file"]').files,o;return r&&(o=await V(r,s,n,e)),{value:null,files:o}})},mn=(t,e,n)=>{t("[pond-paste]","paste",async(i,s)=>{var l,u,m;i.preventDefault();let a=(l=i.clipboardData)==null?void 0:l.items,r=(m=(u=i.clipboardData)==null?void 0:u.getData("text/plain"))!=null?m:null,o;return a&&(o=await V(a,s,n,e)),{value:r,files:o}})},ct=(t,e,n)=>{jt(t),en(t),tn(t),nn(t),sn(t),an(t),rn(t),ln(t),cn(t),dn(t),un(t),hn(t),on(t),pn(t,e,n),fn(t,e,n),mn(t,e,n)};function dt(t){return(e,n,i=!0)=>{let s=t.onMessage((a,r)=>{if(a===e)return i&&s(),n(r)});return s}}function ut(t,e,n){let i=Ie(t,e),s=dt(t);lt(i),ot(i,s,n),ct(i,s,n)}var j,De,ee,Ae,de=class{constructor(){C(this,j);C(this,ee);this._modifiers={};let e=new MutationObserver(n=>{for(let i=0;i<n.length;i++){let s=n[i];switch(s.type){case"childList":for(let o=0;o<s.removedNodes.length;o++){let l=s.removedNodes[o];if(l instanceof HTMLElement){let u=l;L(this,ee,Ae).call(this,u)}}for(let o=0;o<s.addedNodes.length;o++){let l=s.addedNodes[o];if(l instanceof HTMLElement){let u=l;L(this,j,De).call(this,u)}}break;case"attributes":let a=s.target,r=`[${s.attributeName}]`;for(let o in this._modifiers)if(r===o)if(s.oldValue===null){let l=this._modifiers[o],u=a.getAttribute(s.attributeName);l.forEach(m=>{m.onAdd&&m.onAdd(a,null,u)})}else{let l=this._modifiers[o],u=a.getAttribute(s.attributeName);l.forEach(m=>{u&&m.onUpdated?m.onUpdated(a,s.oldValue,u):!u&&m.onRemove&&m.onRemove(a,s.oldValue,null)})}break;default:break}}});e.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0}),this._observer=e}watch(e,n){let i=document.querySelectorAll(e);if(n.onAdd)for(let a=0;a<i.length;a++){let r=i[a],o=e.replace(/[\[\].#]/g,""),l=r.getAttribute(o);n.onAdd(r,null,l)}let s=this._modifiers[e]||[];s.push(n),this._modifiers[e]=s}addEventListener(e,n,i){this.watch(e,{onAdd:s=>{s.addEventListener(n,a=>{i(s,a)},{capture:!0})},onRemove:s=>{s.removeEventListener(n,a=>{i(s,a)},{capture:!0})}})}delegateEvent(e,n,i){document.body.addEventListener(n,s=>{let a=s.target;if(a.tagName.toLowerCase()===e.toLowerCase())return i(a,s);let r=a.parentElement;if(r&&r.tagName.toLowerCase()===e.toLowerCase())return i(r,s);let o=a.firstElementChild;if(o&&o.tagName.toLowerCase()===e.toLowerCase())return i(o,s)})}delegateSelectorEvent(e,n,i){document.body.addEventListener(n,s=>{let r=s.target.closest(e);if(r)return i(r,s)})}onAttributeChange(e,n){this.watch(e,{onAdd:n,onUpdated:n,onRemove:n})}};j=new WeakSet,De=function(e){for(let n in this._modifiers)e.matches(n)&&this._modifiers[n].forEach(s=>{let a=n.replace(/[\[\].#]/g,""),r=e.getAttribute(a);s.onAdd&&s.onAdd(e,null,r)});for(let n=0;n<e.children.length;n++)L(this,j,De).call(this,e.children[n])},ee=new WeakSet,Ae=function(e){for(let n in this._modifiers)e.matches(n)&&this._modifiers[n].forEach(s=>{let a=n.replace(/[\[\].#]/g,""),r=e.getAttribute(a);s.onRemove&&s.onRemove(e,r,null)});for(let n=0;n<e.children.length;n++)L(this,ee,Ae).call(this,e.children[n])};window.onload=()=>{let t=window.__STATE__,e=window.__USER_ID__,n=new de,i=le.connect(e,n,t);Pe(n),ut(i.channel,n,e),h("pond-ready",{userId:e,router:i})};})();
