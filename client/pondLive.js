"use strict";(()=>{var Z=Object.defineProperty,j=Object.defineProperties;var ee=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var P=(n,t,e)=>t in n?Z(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,T=(n,t)=>{for(var e in t||(t={}))te.call(t,e)&&P(n,e,t[e]);if(C)for(var e of C(t))ne.call(t,e)&&P(n,e,t[e]);return n},w=(n,t)=>j(n,ee(t));var L=(n,t,e,s)=>{let r=document.createElement("div");r.innerHTML=t.trim();let o=r.querySelector("#"+e),i=n.querySelector("#"+e);o&&i&&o.replaceWith(i.cloneNode(!0));let a=r.firstElementChild;b(n,a),s&&s.pageTitle&&(document.title=s.pageTitle)},b=(n,t)=>{if(n instanceof Text&&t instanceof Text&&n.textContent!==t.textContent){n.replaceWith(t.cloneNode(!0));return}if(n instanceof Text&&t instanceof Element){n.replaceWith(t.cloneNode(!0));return}if(n instanceof Element&&t instanceof Text){n.replaceWith(t.cloneNode(!0));return}if(n.tagName!==t.tagName){n.replaceWith(t.cloneNode(!0));return}for(let s in t.attributes){let r=t.attributes[s];r&&r.name&&r.value&&(!n.hasAttribute(r.name)||n.getAttribute(r.name)!==r.value)&&n.setAttribute(r.name,r.value)}for(let s in n.attributes){let r=n.attributes[s];r&&r.name&&r.value&&(t.hasAttribute(r.name)?t.hasAttribute(r.name)&&t.getAttribute(r.name)!==r.value&&n.setAttribute(r.name,t.getAttribute(r.name)):n.removeAttribute(r.name))}let e=Math.max(n.childNodes.length,t.childNodes.length);for(let s=0;s<e;s++){let r=n.childNodes[s],o=t.childNodes[s];if(r&&o)b(r,o);else{if(r)return se(n,s);o&&n.appendChild(o.cloneNode(!0))}}},se=(n,t)=>{let e=n.childNodes;for(let s=e.length-1;s>=t;s--)e[s].remove()};var u=(n,t,e)=>{let s=new CustomEvent(n,{detail:t,bubbles:!0,cancelable:!0});e?e.dispatchEvent(s):window.dispatchEvent(s)},F=(n,t,e)=>{n.broadcastFrom(`event/${t}`,e)},x=(n,t,e)=>{n.broadcastFrom(t,e)};var N=async n=>{u("navigate-start",{location:n,shallow:!1}),history.pushState(null,"",n),await R(n),u("navigate-end",{location:n,shallow:!1})};window.addEventListener("popstate",async()=>{u("navigate-start",{location:location.pathname,shallow:!1}),await R(location.pathname),u("navigate-end",{location:location.pathname,shallow:!1})});var R=async n=>{let t={"Content-Type":"text/html",Accept:"text/html","x-csrf-token":window.token,"x-router-request":"true",method:"GET"},e=await fetch(n,{headers:t}),s=e.headers;if(s.has("x-router-action")){let r=s.get("x-router-action");if(r){let o=s.get("x-router-path"),i=s.get("x-page-title"),a=s.get("x-flash-message");await D(o,r,i,a)}}else{let r=s.get("x-router-container"),o=s.get("x-page-title"),i=s.get("x-flash-message"),a=await e.text();re(r,a,o,i)}},k=n=>{n.delegateEvent("a","click",async(t,e)=>{e.preventDefault();let r=t.href;await N(r)})},y=(n,t)=>{n&&(document.title=n),t&&u("flash-message",{flashMessage:t})},D=async(n,t,e,s)=>{switch(t){case"replace":u("navigate-start",{location:n,shallow:!1}),history.replaceState(null,"",n),u("navigate-end",{location:n,shallow:!1});break;case"redirect":await N(n);break;case"reload":window.location.reload();break}y(e,s)},re=(n,t,e,s)=>{let r=document.querySelector(n);if(r){let o=document.createElement("div");o.innerHTML=t;let i=o.firstElementChild,a=i.getAttribute("pond-router");a&&r.setAttribute("pond-router",a),b(r,i),e&&(document.title=e),s&&u("flash-message",{flashMessage:s})}};var A=(n,t)=>{if(n===void 0)return t;if(t===void 0)return n;for(let e in t)t[e]instanceof Object?n[e]=A(n[e],t[e]):t[e]===null?delete n[e]:n[e]=t[e];return n instanceof Array?n.filter(e=>e!=null):n};var I={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},oe=new RegExp(Object.keys(I).join("|"),"g");function S(n,t){return t==null&&(t=","),n.length<=0?new g([""],[]):new g(["",...Array(n.length-1).fill(t),""],n)}function O(n){return n==null?"":n instanceof g?n.toString():Array.isArray(n)?S(n,"").toString():String(n).replace(oe,t=>I[t])}var g=class{constructor(t,e){this.statics=t,this.dynamics=e}toString(){let t=this.statics[0];for(let e=0;e<this.dynamics.length;e++)this.dynamics[e]instanceof g?t+=this.dynamics[e].toString()+this.statics[e+1]:Array.isArray(this.dynamics[e])?t+=S(this.dynamics[e],"").toString()+this.statics[e+1]:typeof this.dynamics[e]=="object"?t+=this.parsedHtmlToString(this.dynamics[e])+this.statics[e+1]:t+=O(this.dynamics[e])+this.statics[e+1];return t}getParts(){let t={s:this.statics};for(let e=0;e<this.dynamics.length;e++)this.dynamics[e]instanceof g?t[e]=this.dynamics[e].getParts():Array.isArray(this.dynamics[e])?t[e]=S(this.dynamics[e],"").getParts():this.dynamics[e]===void 0?t[e]=null:t[e]=this.dynamics[e];return t}parsedHtmlToString(t){var r;let e=t,s="";if(Array.isArray(e))return S(e,"").toString();if(((r=e==null?void 0:e.s)==null?void 0:r.length)>0){let o=e.s.filter(i=>i!=null);s=e.s[0];for(let i=0;i<o.length-1;i++)typeof e[i]=="object"?s+=this.parsedHtmlToString(t[i])+e.s[i+1]:s+=O(t[i])+e.s[i+1]}return s}reconstruct(t){let e=A(this.getParts(),t);return this.parse(e)}parse(t){let e=t,s=e.s||[""];delete e.s;let r=Object.values(e).filter(o=>o!=null);return new g(s,r)}};function U(n,...t){return new g(n,t)}var B=n=>{n.onMessage("router",async t=>{let{action:e,path:s}=t;await D(s,e)}),n.onMessage("emit",t=>{u(t.event,t.data)})},W=(n,t)=>{let e={},s={},r=a=>{let c=a.getAttribute("pond-router");if(c&&!e[c]){let l=n.onMessage("rendered",async d=>{if(d.path===c){let h=U``.parse(d.rendered);s[c]=h;let f=h.toString();L(a,f,c,d.headers),y(d.headers.pageTitle,d.headers.flashMessage)}}),p=n.onMessage("updated",async d=>{if(d.path===c){let h=s[c].reconstruct(d.rendered);s[c]=h;let f=h.toString();L(a,f,c,d.headers),y(d.headers.pageTitle,d.headers.flashMessage)}});e[c]={unsubscribe:()=>{l.unsubscribe(),p.unsubscribe()}},n.broadcastFrom(`mount/${c}`,{})}},o=(a,c)=>{let l=c;l&&e[l]&&(n.broadcastFrom(`unmount/${l}`,{}),e[l].unsubscribe(),delete e[l],delete s[l])},i=(a,c)=>{let l=a.getAttribute("pond-router");c&&l?c!==l?(o(a,c),r(a)):e[l]&&n.broadcastFrom(`update/${l}`,{}):c&&e[c]?o(a,c):l&&!e[l]&&r(a)};t.watch("[pond-router]",{onAdd:r,onRemove:o,onUpdated:i})};var M=class{constructor(){this._modifiers={};let t=new MutationObserver(e=>{for(let s=0;s<e.length;s++){let r=e[s];switch(r.type){case"childList":for(let a=0;a<r.removedNodes.length;a++){let c=r.removedNodes[a];if(c instanceof HTMLElement){let l=c;for(let p in this._modifiers)l.matches(p)&&this._modifiers[p].forEach(m=>{m.onRemove&&m.onRemove(l,null)})}}for(let a=0;a<r.addedNodes.length;a++){let c=r.addedNodes[a];if(c instanceof HTMLElement){let l=c;this._addNewElement(l)}}break;case"attributes":let o=r.target,i=`[${r.attributeName}]`;for(let a in this._modifiers)if(i===a||o.matches(a))if(r.oldValue===null)this._modifiers[a].forEach(l=>{l.onAdd&&l.onAdd(o,null)});else{let c=this._modifiers[a],l=o.getAttribute(r.attributeName);c.forEach(p=>{l?p.onUpdated&&p.onUpdated(o,r.oldValue):p.onRemove&&p.onRemove(o,r.oldValue)})}}}});t.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0}),this._observer=t}watch(t,e){let s=document.querySelectorAll(t);for(let o=0;o<s.length;o++){let i=s[o];e.onAdd&&e.onAdd(i,null)}let r=this._modifiers[t]||[];r.push(e),this._modifiers[t]=r}unwatch(t){delete this._modifiers[t]}isWatching(t){return!!this._modifiers[t]}addEventListener(t,e,s){this.watch(t,{onAdd:r=>{r.addEventListener(e,o=>{s(r,o)},{capture:!0})},onRemove:r=>{r.removeEventListener(e,o=>{s(r,o)},{capture:!0})}})}delegateEvent(t,e,s){document.body.addEventListener(e,r=>{let o=r.target;if(o.tagName.toLowerCase()===t.toLowerCase())return s(o,r);let i=o.parentElement;if(i&&i.tagName.toLowerCase()===t.toLowerCase())return s(i,r);let a=o.firstElementChild;if(a&&a.tagName.toLowerCase()===t.toLowerCase())return s(a,r)})}delegateSelectorEvent(t,e,s){document.body.addEventListener(e,r=>{let i=r.target.closest(t);if(i)return s(i,r)})}shutdown(){for(let t in this._modifiers)this.unwatch(t);this._observer.disconnect()}_addNewElement(t){for(let e in this._modifiers)t.matches(e)&&this._modifiers[e].forEach(r=>{r.onAdd&&r.onAdd(t,null)});for(let e=0;e<t.children.length;e++)this._addNewElement(t.children[e])}};var ie=n=>{n("[pond-click]","click",()=>({value:null}))},ae=n=>{n("[pond-mouseenter]","mouseenter",()=>({value:null}))},ce=n=>{n("[pond-mouseleave]","mouseleave",()=>({value:null}))},le=n=>{n("[pond-mousemove]","mousemove",()=>({value:null}))},de=n=>{n("[pond-mousedown]","mousedown",()=>({value:null}))},ue=n=>{n("[pond-mouseup]","mouseup",()=>({value:null}))},pe=n=>{n("[pond-double-click]","dblclick",()=>({value:null}))},me=n=>{n("[pond-drag-start]","dragstart",(t,e)=>{let s=e.getBoundingClientRect(),r={top:s.top,left:s.left,width:s.width,height:s.height};return{value:null,dragData:r}})},he=n=>{n("[pond-drag-end]","dragend",(t,e)=>{let s=e.getBoundingClientRect(),r={top:s.top,left:s.left,width:s.width,height:s.height};return{value:null,dragData:r}})},ge=n=>{n("[pond-drag-over]","dragover",(t,e)=>{let s=e.getBoundingClientRect(),r={top:s.top,left:s.left,width:s.width,height:s.height};return{value:null,dragData:r}})},fe=n=>{n("[pond-drag-enter]","dragenter",(t,e)=>{let s=e.getBoundingClientRect(),r={top:s.top,left:s.left,width:s.width,height:s.height};return{value:null,dragData:r}})},ve=n=>{n("[pond-drag-leave]","dragleave",(t,e)=>{let s=e.getBoundingClientRect(),r={top:s.top,left:s.left,width:s.width,height:s.height};return{value:null,dragData:r}})},Ee=n=>{n("[pond-drop]","drop",(t,e)=>{let s=e.getBoundingClientRect(),r={top:s.top,left:s.left,width:s.width,height:s.height};return{value:null,dragData:r}})},q=n=>{ie(n),ae(n),ce(n),le(n),de(n),ue(n),pe(n),me(n),he(n),ge(n),fe(n),ve(n),Ee(n)};var be=n=>{n("[pond-keydown]","keydown",t=>({value:t.target.value}))},ye=n=>{n("[pond-keyup]","keyup",t=>({value:t.target.value}))},Se=n=>{n("[pond-keypress]","keypress",t=>({value:t.target.value}))},Me=n=>{n("[pond-change]","change",t=>({value:t.target.value}))},$=n=>{be(n),ye(n),Se(n),Me(n)};var _e=n=>{n("[pond-focus]","focus",(t,e)=>({value:null,dataId:e.getAttribute("pond-data-id")}))},He=n=>{n("[pond-blur]","blur",(t,e)=>({value:null,dataId:e.getAttribute("pond-data-id")}))},Te=n=>{n("[pond-change]","change",(t,e)=>({value:null,dataId:e.getAttribute("pond-data-id")}))},we=n=>{n("[pond-input]","input",(t,e)=>({value:null,dataId:e.getAttribute("pond-data-id")}))},Le=n=>{n("[pond-submit]","submit",(t,e)=>{t.preventDefault();let s=e;return{value:null,formData:new FormData(s),dataId:e.getAttribute("pond-data-id")}})},G=n=>{_e(n),He(n),Te(n),we(n),Le(n)};var J=(n,t,e,s,r)=>{let o=new XMLHttpRequest;return o.open("POST",s),o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.setRequestHeader("x-csrf-token",e),o.setRequestHeader("x-router-request","true"),o.setRequestHeader("x-router-path",n),o.setRequestHeader("x-router-event",t),o.onreadystatechange=()=>{if(o.readyState===4&&o.status===200){let i=JSON.parse(o.responseText);u("pond-upload-success",i,r)}else u("pond-upload-error",o.responseText,r)},o.onloadstart=()=>u("pond-upload-start",{}),o.onloadend=()=>u("pond-upload-end",{}),o.onprogress=i=>{i.lengthComputable&&u("pond-upload-progress",{progress:Math.round(i.loaded/i.total*100)},r)},o},De=(n,t,e,s,r,o,i)=>{let a=o.onMessage(`uploadToken/${t}`,l=>{a.unsubscribe();let p=J(r,s,l.token,l.uploadPath,i),d=new FormData;d.append(e,n,n.name),p.send(d)}),c=o.onMessage(`uploadError/${t}`,l=>{c.unsubscribe(),u("pond-upload-error",l.error,i)});return{unsubscribe:()=>{a.unsubscribe(),c.unsubscribe()}}},Ae=n=>{let t=[];if(!n)return t;for(let e=0;e<n.length;e++)t.push({path:`/${n[e].name}`,file:n[e]});return t},Ce=n=>new Promise(async t=>{let e=[];for(let o=0;o<n.length;o++){let i=n[o].webkitGetAsEntry();i&&e.push(i)}let s=e.map(o=>K(o)),r=await Promise.all(s);t(r.flat())}),K=(n,t="/")=>new Promise(e=>{if(n.isFile)n.file(r=>{let o=`${t}${r.name}`;e([{path:o,file:r}])});else if(n.isDirectory){let s=n,r=s.createReader(),o=[];r.readEntries(async i=>{for(let a=0;a<i.length;a++){let c=i[a],l=`${t}${s.name}/`,p=await K(c,l);o.push(...p)}e(o)})}}),z=async(n,t,e,s,r)=>{let o=[],i=[],a=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);n instanceof DataTransferItemList?o=await Ce(n):n instanceof FileList&&(o=Ae(n));let c=t.onMessage(`uploadToken/${a}`,d=>{c.unsubscribe(),i.forEach(f=>f.unsubscribe());let m=J(e,s,d.token,d.uploadPath,r),h=new FormData;o.forEach(f=>h.append(f.path,f.file,f.file.name)),m.send(h)}),l=t.onMessage(`uploadError/${a}`,d=>{l.unsubscribe(),i.forEach(m=>m.unsubscribe()),u("pond-upload-error",d.error,r)});return{metaData:o.map(d=>{let m=V(d.file)[0],h=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);return i.push(De(d.file,h,d.path,s,e,t,r)),{name:m.name,size:m.size,type:m.type,identifier:h,lastModified:m.lastModified,lastModifiedDate:m.lastModifiedDate}}),identifier:a}},V=n=>{let t=[];if(n instanceof FileList)for(let e=0;e<n.length;e++)t.push({name:n[e].name,size:n[e].size,type:n[e].type,lastModified:n[e].lastModified,lastModifiedDate:new Date(n[e].lastModified)});else n instanceof File&&t.push({name:n.name,size:n.size,type:n.type,lastModified:n.lastModified,lastModifiedDate:new Date(n.lastModified)});return t},Pe=n=>{n("[pond-file]","change",(t,e)=>{let r=e.files;if(r){let o=V(r);return{value:null,files:o}}return null})},Fe=(n,t)=>{t("[pond-upload]","submit",async(e,s,r,o)=>{e.preventDefault();let i=s.querySelector('input[type="file"]'),a=i.files;if(a){let{metaData:c,identifier:l}=await z(a,n,r,o,i);return{value:null,files:c,event:`${r}/upload/token`,metadata:{identifier:l,type:"UPLOAD_REQUEST"}}}return null})},xe=(n,t)=>{t("[pond-drop-upload]","drop",async(e,s,r,o)=>{var a;let i=(a=e.dataTransfer)==null?void 0:a.items;if(i){let{metaData:c,identifier:l}=await z(i,n,r,o,s);return{value:null,files:c,event:`${r}/upload/token`,metadata:{identifier:l,type:"UPLOAD_REQUEST"}}}return null})},X=(n,t)=>{Pe(t),Fe(n,t),xe(n,t)};var Ne=async(n,t,e,s,r)=>{r.preventDefault();let o=t.replace("[","").replace("]",""),i=s.closest("[pond-router]"),a=s.getAttribute(o),c=s.getAttribute("pond-data-id");if(i&&a){let l=i.getAttribute("pond-router");if(l){let p=await e(r,s,l,a);p&&(p.event?x(n,p.event,w(T({},p),{dataId:c,type:a})):F(n,l,w(T({},p),{dataId:c,type:a})))}}},Q=(n,t)=>(e,s,r)=>{t.addEventListener(e,s,async(o,i)=>{await Ne(n,e,r,o,i)})};var v=class{constructor(){this._subscribers=new Set}subscribe(t){return this._subscribers.add(t),{unsubscribe:()=>{this._subscribers.delete(t)}}}publish(t){let e;for(let s of this._subscribers)try{if(e=s(t),e)break}catch(r){throw r}return e}clear(){this._subscribers.clear()}},E=class extends v{constructor(e){super();this._value=e}get value(){return this._value}get observers(){return this._subscribers}subscribe(e){return e(this._value),super.subscribe(e)}publish(e){if(this._value!==e)return this._value=e,super.publish(e)}};var _=class{constructor(t,e,s,r){this._name=t,this._joinParams=r||{},this._broadcaster=s,this._connection=new E(!1),this._receiver=new v,this._subscription=e.subscribe(o=>{o.channelName===t&&(this._receiver.publish(o),this._connection.publish(!0))}),this._presence=new E({change:null,presence:[]})}join(){let t={action:"JOIN_CHANNEL",channelName:this._name,event:"JOIN_CHANNEL",payload:this._joinParams};this._receiver.subscribe(e=>{e.action==="PRESENCE"&&this._presence.publish(e.payload)}),this._broadcaster.publish(t)}leave(){let t={action:"LEAVE_CHANNEL",channelName:this._name,event:"LEAVE_CHANNEL",payload:{}};this._broadcaster.publish(t),this._connection.publish(!1),this._subscription.unsubscribe(),this._connection.clear(),this._receiver.clear(),this._presence.clear()}onMessage(t,e){return this._receiver.subscribe(s=>{s.action==="MESSAGE"&&s.event===t&&e(s.payload)})}broadcast(t,e){let s={action:"BROADCAST",channelName:this._name,payload:e,event:t};this._broadcaster.publish(s)}broadcastFrom(t,e){let s={action:"BROADCAST_FROM",channelName:this._name,payload:e,event:t};this._broadcaster.publish(s)}sendMessage(t,e,s){let r={action:"SEND_MESSAGE_TO_USER",channelName:this._name,payload:e,event:t,addresses:s};this._broadcaster.publish(r)}updatePresence(t){let e={action:"UPDATE_PRESENCE",channelName:this._name,payload:t,event:"UPDATE_PRESENCE"};this._broadcaster.publish(e)}onPresence(t){return this._presence.subscribe(e=>{t(e.change,e.presence)})}onConnectionChange(t){return this._connection.subscribe(e=>{t(e)})}};var H=class{constructor(t,e){let s;try{s=new URL(t)}catch(i){s=new URL(window.location.toString()),s.pathname=t}let r=new URLSearchParams(e);s.search=r.toString();let o=s.protocol==="https:"?"wss:":"ws:";s.protocol!=="wss:"&&s.protocol!=="ws:"&&(s.protocol=o),this.address=s,this._socketState="CLOSED",this._channels={},this._broadcaster=new v,this._receiver=new v}getState(){return this._socketState}connect(t=1){let e=new WebSocket(this.address.toString()),s=this._receiver.subscribe(r=>{e.send(JSON.stringify(r))});e.onopen=()=>{this._socketState="OPEN"},e.onclose=()=>{this._socketState="CLOSED",s.unsubscribe()},e.onmessage=r=>{let o=JSON.parse(r.data);this._broadcaster.publish(o)},e.onerror=()=>{this._socketState="CLOSED",s.unsubscribe(),setTimeout(()=>{this.connect(t*2)},t*1e3)},this._socket=e}disconnect(){var t;Object.values(this._channels).forEach(e=>e.leave()),this._socketState="CLOSED",this._broadcaster.clear(),this._receiver.clear(),(t=this._socket)==null||t.close(),this._channels={}}onMessage(t,e){return this._broadcaster.subscribe(s=>{s.action==="MESSAGE"&&s.event===t&&e(s.payload)})}createChannel(t,e){if(this._channels[t])return this._channels[t];let s=new _(t,this._broadcaster,this._receiver,e);return this._channels[t]=s,s}};var Y=()=>{let n=new H("/live");n.connect(),n.onMessage("token",t=>{window.token=t.csrfToken;let e=new M,s=n.createChannel(`/${t.nanoId}`,{clientId:t.csrfToken});s.join();let r=!1;s.onConnectionChange(o=>{if(o){let i=Q(s,e);W(s,e),q(i),$(i),G(i),k(e),B(s),X(s,i),r||(r=!0,u("pondReady",s))}})})};window.addEventListener("load",()=>{Y()});})();
