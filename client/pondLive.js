"use strict";(()=>{var Z=Object.defineProperty,j=Object.defineProperties;var ee=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var C=(n,t,e)=>t in n?Z(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,H=(n,t)=>{for(var e in t||(t={}))te.call(t,e)&&C(n,e,t[e]);if(A)for(var e of A(t))ne.call(t,e)&&C(n,e,t[e]);return n},D=(n,t)=>j(n,ee(t));var w=(n,t,e,s)=>{let r=document.createElement("div");r.innerHTML=t.trim();let i=r.querySelector("#"+e),o=n.querySelector("#"+e);i&&o&&i.replaceWith(o.cloneNode(!0));let a=r.firstElementChild;b(n,a),s&&s.pageTitle&&(document.title=s.pageTitle)},b=(n,t)=>{if(n instanceof Text&&t instanceof Text&&n.textContent!==t.textContent){n.replaceWith(t.cloneNode(!0));return}if(n instanceof Text&&t instanceof Element){n.replaceWith(t.cloneNode(!0));return}if(n instanceof Element&&t instanceof Text){n.replaceWith(t.cloneNode(!0));return}if(n.tagName!==t.tagName){n.replaceWith(t.cloneNode(!0));return}for(let s in t.attributes){let r=t.attributes[s];r&&r.name&&r.value&&(!n.hasAttribute(r.name)||n.getAttribute(r.name)!==r.value)&&n.setAttribute(r.name,r.value)}for(let s in n.attributes){let r=n.attributes[s];r&&r.name&&r.value&&(t.hasAttribute(r.name)?t.hasAttribute(r.name)&&t.getAttribute(r.name)!==r.value&&n.setAttribute(r.name,t.getAttribute(r.name)):n.removeAttribute(r.name))}let e=Math.max(n.childNodes.length,t.childNodes.length);for(let s=0;s<e;s++){let r=n.childNodes[s],i=t.childNodes[s];if(r&&i)b(r,i);else{if(r)return se(n,s);i&&n.appendChild(i.cloneNode(!0))}}},se=(n,t)=>{let e=n.childNodes;for(let s=e.length-1;s>=t;s--)e[s].remove()};var p=(n,t,e)=>{let s=new CustomEvent(n,{detail:t,bubbles:!0,cancelable:!0});e?e.dispatchEvent(s):window.dispatchEvent(s)},F=(n,t,e)=>{n.broadcastFrom(`event/${t}`,e)},N=(n,t,e)=>{n.broadcastFrom(t,e)};var R=async n=>{p("navigate-start",{location:n,shallow:!1}),history.pushState(null,"",n),await x(n),p("navigate-end",{location:n,shallow:!1})};window.addEventListener("popstate",async()=>{p("navigate-start",{location:location.pathname,shallow:!1}),await x(location.pathname),p("navigate-end",{location:location.pathname,shallow:!1})});var x=async n=>{let t={"Content-Type":"text/html",Accept:"text/html","x-csrf-token":window.token,"x-router-request":"true",method:"GET"},e=await fetch(n,{headers:t}),s=e.headers;if(s.has("x-router-action")){let r=s.get("x-router-action");if(r){let i=s.get("x-router-path"),o=s.get("x-page-title"),a=s.get("x-flash-message");await L(i,r,o,a)}}else{let r=s.get("x-router-container"),i=s.get("x-page-title"),o=s.get("x-flash-message"),a=await e.text();re(r,a,i,o)}},O=n=>{n.delegateEvent("a","click",async(t,e)=>{e.preventDefault();let r=t.href;await R(r)})},y=(n,t)=>{n&&(document.title=n),t&&p("flash-message",{flashMessage:t})},L=async(n,t,e,s)=>{switch(t){case"replace":p("navigate-start",{location:n,shallow:!1}),history.replaceState(null,"",n),p("navigate-end",{location:n,shallow:!1});break;case"redirect":await R(n);break;case"reload":window.location.reload();break}y(e,s)},re=(n,t,e,s)=>{let r=document.querySelector(n);if(r){let i=document.createElement("div");i.innerHTML=t;let o=i.firstElementChild,a=o.getAttribute("pond-router");a&&r.setAttribute("pond-router",a),b(r,o),e&&(document.title=e),s&&p("flash-message",{flashMessage:s})}};var P=(n,t)=>{if(n===void 0)return t;if(t===void 0)return n;for(let e in t)t[e]instanceof Object?n[e]=P(n[e],t[e]):t[e]===null?delete n[e]:n[e]=t[e];return n instanceof Array?n.filter(e=>e!=null):n};var I={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},ie=new RegExp(Object.keys(I).join("|"),"g");function _(n,t){return t==null&&(t=","),n.length<=0?new g([""],[]):new g(["",...Array(n.length-1).fill(t),""],n)}function k(n){return n==null?"":n instanceof g?n.toString():Array.isArray(n)?_(n,"").toString():String(n).replace(ie,t=>I[t])}var g=class{constructor(t,e){this.statics=t,this.dynamics=e}toString(){let t=this.statics[0];for(let e=0;e<this.dynamics.length;e++)this.dynamics[e]instanceof g?t+=this.dynamics[e].toString()+this.statics[e+1]:Array.isArray(this.dynamics[e])?t+=_(this.dynamics[e],"").toString()+this.statics[e+1]:typeof this.dynamics[e]=="object"?t+=this.parsedHtmlToString(this.dynamics[e])+this.statics[e+1]:t+=k(this.dynamics[e])+this.statics[e+1];return t}getParts(){let t={s:this.statics};for(let e=0;e<this.dynamics.length;e++)this.dynamics[e]instanceof g?t[e]=this.dynamics[e].getParts():Array.isArray(this.dynamics[e])?t[e]=_(this.dynamics[e],"").getParts():this.dynamics[e]===void 0?t[e]=null:t[e]=this.dynamics[e];return t}parsedHtmlToString(t){var r;let e=t,s="";if(Array.isArray(e))return _(e,"").toString();if(((r=e==null?void 0:e.s)==null?void 0:r.length)>0){let i=e.s.filter(o=>o!=null);s=e.s[0];for(let o=0;o<i.length-1;o++)typeof e[o]=="object"?s+=this.parsedHtmlToString(t[o])+e.s[o+1]:s+=k(t[o])+e.s[o+1]}return s}reconstruct(t){let e=P(this.getParts(),t);return this.parse(e)}parse(t){let e=t,s=e.s||[""];delete e.s;let r=Object.values(e).filter(i=>i!=null);return new g(s,r)}};function U(n,...t){return new g(n,t)}var B=n=>{n.onMessage("router",async t=>{let{action:e,path:s}=t;await L(s,e)}),n.onMessage("emit",t=>{p(t.event,t.data)})},W=(n,t)=>{let e={},s={},r=a=>{let c=a.getAttribute("pond-router");if(c&&!e[c]){let l=n.onMessage("rendered",async d=>{if(d.path===c){let h=U``.parse(d.rendered);s[c]=h;let f=h.toString();w(a,f,c,d.headers),y(d.headers.pageTitle,d.headers.flashMessage)}}),u=n.onMessage("updated",async d=>{if(d.path===c){let h=s[c].reconstruct(d.rendered);s[c]=h;let f=h.toString();w(a,f,c,d.headers),y(d.headers.pageTitle,d.headers.flashMessage)}});e[c]={unsubscribe:()=>{l.unsubscribe(),u.unsubscribe()}},n.broadcastFrom(`mount/${c}`,{})}},i=(a,c)=>{let l=c;l&&e[l]&&(n.broadcastFrom(`unmount/${l}`,{}),e[l].unsubscribe(),delete e[l],delete s[l])},o=(a,c)=>{let l=a.getAttribute("pond-router");c&&l?c!==l?(i(a,c),r(a)):e[l]&&n.broadcastFrom(`update/${l}`,{}):c&&e[c]?i(a,c):l&&!e[l]&&r(a)};t.watch("[pond-router]",{onAdd:r,onRemove:i,onUpdated:o})};var M=class{constructor(){this._modifiers={};let t=new MutationObserver(e=>{for(let s=0;s<e.length;s++){let r=e[s];switch(r.type){case"childList":for(let a=0;a<r.removedNodes.length;a++){let c=r.removedNodes[a];if(c instanceof HTMLElement){let l=c;for(let u in this._modifiers)l.matches(u)&&this._modifiers[u].forEach(m=>{m.onRemove&&m.onRemove(l,null)})}}for(let a=0;a<r.addedNodes.length;a++){let c=r.addedNodes[a];if(c instanceof HTMLElement){let l=c;this._addNewElement(l)}}break;case"attributes":let i=r.target,o=`[${r.attributeName}]`;for(let a in this._modifiers)if(o===a||i.matches(a))if(r.oldValue===null)this._modifiers[a].forEach(l=>{l.onAdd&&l.onAdd(i,null)});else{let c=this._modifiers[a],l=i.getAttribute(r.attributeName);c.forEach(u=>{l?u.onUpdated&&u.onUpdated(i,r.oldValue):u.onRemove&&u.onRemove(i,r.oldValue)})}}}});t.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0}),this._observer=t}watch(t,e){let s=document.querySelectorAll(t);for(let i=0;i<s.length;i++){let o=s[i];e.onAdd&&e.onAdd(o,null)}let r=this._modifiers[t]||[];r.push(e),this._modifiers[t]=r}unwatch(t){delete this._modifiers[t]}isWatching(t){return!!this._modifiers[t]}addEventListener(t,e,s){this.watch(t,{onAdd:r=>{r.addEventListener(e,i=>{s(r,i)},{capture:!0})},onRemove:r=>{r.removeEventListener(e,i=>{s(r,i)},{capture:!0})}})}delegateEvent(t,e,s){document.body.addEventListener(e,r=>{let i=r.target;if(i.tagName.toLowerCase()===t.toLowerCase())return s(i,r);let o=i.parentElement;if(o&&o.tagName.toLowerCase()===t.toLowerCase())return s(o,r);let a=i.firstElementChild;if(a&&a.tagName.toLowerCase()===t.toLowerCase())return s(a,r)})}delegateSelectorEvent(t,e,s){document.body.addEventListener(e,r=>{let o=r.target.closest(t);if(o)return s(o,r)})}shutdown(){for(let t in this._modifiers)this.unwatch(t);this._observer.disconnect()}_addNewElement(t){for(let e in this._modifiers)t.matches(e)&&this._modifiers[e].forEach(r=>{r.onAdd&&r.onAdd(t,null)});for(let e=0;e<t.children.length;e++)this._addNewElement(t.children[e])}};var oe=n=>{n("[pond-click]","click",()=>({value:null}))},ae=n=>{n("[pond-mouseenter]","mouseenter",()=>({value:null}))},ce=n=>{n("[pond-mouseleave]","mouseleave",()=>({value:null}))},le=n=>{n("[pond-mousemove]","mousemove",()=>({value:null}))},de=n=>{n("[pond-mousedown]","mousedown",()=>({value:null}))},ue=n=>{n("[pond-mouseup]","mouseup",()=>({value:null}))},pe=n=>{n("[pond-double-click]","dblclick",()=>({value:null}))},me=n=>{n("[pond-drag-start]","dragstart",(t,e)=>{let s=e.getBoundingClientRect(),r={top:s.top,left:s.left,width:s.width,height:s.height};return{value:null,dragData:r}})},he=n=>{n("[pond-drag-end]","dragend",(t,e)=>{let s=e.getBoundingClientRect(),r={top:s.top,left:s.left,width:s.width,height:s.height};return{value:null,dragData:r}})},ge=n=>{n("[pond-drag-over]","dragover",(t,e)=>{let s=e.getBoundingClientRect(),r={top:s.top,left:s.left,width:s.width,height:s.height};return{value:null,dragData:r}})},fe=n=>{n("[pond-drag-enter]","dragenter",(t,e)=>{let s=e.getBoundingClientRect(),r={top:s.top,left:s.left,width:s.width,height:s.height};return{value:null,dragData:r}})},ve=n=>{n("[pond-drag-leave]","dragleave",(t,e)=>{let s=e.getBoundingClientRect(),r={top:s.top,left:s.left,width:s.width,height:s.height};return{value:null,dragData:r}})},Ee=n=>{n("[pond-drop]","drop",(t,e)=>{let s=e.getBoundingClientRect(),r={top:s.top,left:s.left,width:s.width,height:s.height};return{value:null,dragData:r}})},q=n=>{oe(n),ae(n),ce(n),le(n),de(n),ue(n),pe(n),me(n),he(n),ge(n),fe(n),ve(n),Ee(n)};var be=n=>{n("[pond-keydown]","keydown",t=>({value:t.target.value}))},ye=n=>{n("[pond-keyup]","keyup",t=>({value:t.target.value}))},_e=n=>{n("[pond-keypress]","keypress",t=>({value:t.target.value}))},Me=n=>{n("[pond-change]","change",t=>({value:t.target.value}))},$=n=>{be(n),ye(n),_e(n),Me(n)};var Se=n=>{n("[pond-focus]","focus",(t,e)=>({value:null,dataId:e.getAttribute("pond-data-id")}))},Te=n=>{n("[pond-blur]","blur",(t,e)=>({value:null,dataId:e.getAttribute("pond-data-id")}))},He=n=>{n("[pond-change]","change",(t,e)=>({value:null,dataId:e.getAttribute("pond-data-id")}))},De=n=>{n("[pond-input]","input",(t,e)=>({value:null,dataId:e.getAttribute("pond-data-id")}))},we=n=>{n("[pond-submit]","submit",(t,e)=>{t.preventDefault();let s=e.querySelectorAll("input, select, textarea"),r={};return s.forEach((i,o)=>{r[i.getAttribute("name")||`${o}`]=i.value}),{value:null,formData:r,dataId:e.getAttribute("pond-data-id")}})},G=n=>{Se(n),Te(n),He(n),De(n),we(n)};var J=(n,t,e,s,r)=>{let i=new XMLHttpRequest;return i.open("POST",s),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.setRequestHeader("x-csrf-token",e),i.setRequestHeader("x-router-request","true"),i.setRequestHeader("x-router-path",n),i.setRequestHeader("x-router-event",t),i.onreadystatechange=()=>{if(i.readyState===4&&i.status===200){let o=JSON.parse(i.responseText);p("pond-upload-success",o,r)}else p("pond-upload-error",i.responseText,r)},i.onloadstart=()=>p("pond-upload-start",{}),i.onloadend=()=>p("pond-upload-end",{}),i.onprogress=o=>{o.lengthComputable&&p("pond-upload-progress",{progress:Math.round(o.loaded/o.total*100)},r)},i},Le=(n,t,e,s,r,i,o)=>{let a=[],c=i.onMessage(`uploadToken/${t}`,u=>{a.forEach(h=>h.unsubscribe());let d=J(r,s,u.token,u.uploadPath,o),m=new FormData;m.append(e,n,n.name),d.send(m)}),l=i.onMessage(`uploadError/${t}`,u=>{a.forEach(d=>d.unsubscribe()),p("pond-upload-error",u.error,o)});return a.push(c),a.push(l),{unsubscribe:()=>{c.unsubscribe(),l.unsubscribe()}}},Pe=n=>{let t=[];if(!n)return t;for(let e=0;e<n.length;e++)t.push({path:`/${n[e].name}`,file:n[e]});return t},Ae=n=>new Promise(async t=>{let e=[];for(let i=0;i<n.length;i++){let o=n[i].webkitGetAsEntry();o&&e.push(o)}let s=e.map(i=>V(i)),r=await Promise.all(s);t(r.flat())}),V=(n,t="/")=>new Promise(e=>{if(n.isFile)n.file(r=>{let i=`${t}${r.name}`;e([{path:i,file:r}])});else if(n.isDirectory){let s=n,r=s.createReader(),i=[];r.readEntries(async o=>{for(let a=0;a<o.length;a++){let c=o[a],l=`${t}${s.name}/`,u=await V(c,l);i.push(...u)}e(i)})}}),K=async(n,t,e,s,r)=>{let i=[],o=[],a=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);n instanceof DataTransferItemList?i=await Ae(n):n instanceof FileList&&(i=Pe(n));let c=t.onMessage(`uploadToken/${a}`,d=>{o.forEach(f=>f.unsubscribe());let m=J(e,s,d.token,d.uploadPath,r),h=new FormData;i.forEach(f=>h.append(f.path,f.file,f.file.name)),m.send(h)}),l=t.onMessage(`uploadError/${a}`,d=>{o.forEach(m=>m.unsubscribe()),p("pond-upload-error",d.error,r)});return o.push(c),o.push(l),{metaData:i.map(d=>{let m=z(d.file)[0],h=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);return o.push(Le(d.file,h,d.path,s,e,t,r)),{name:m.name,size:m.size,type:m.type,identifier:h,lastModified:m.lastModified,lastModifiedDate:m.lastModifiedDate}}),identifier:a}},z=n=>{let t=[];if(n instanceof FileList)for(let e=0;e<n.length;e++)t.push({name:n[e].name,size:n[e].size,type:n[e].type,lastModified:n[e].lastModified,lastModifiedDate:new Date(n[e].lastModified)});else n instanceof File&&t.push({name:n.name,size:n.size,type:n.type,lastModified:n.lastModified,lastModifiedDate:new Date(n.lastModified)});return t},Ce=n=>{n("[pond-file]","change",(t,e)=>{let r=e.files;if(r){let i=z(r);return{value:null,files:i}}return null})},Fe=(n,t)=>{t("[pond-upload]","submit",async(e,s,r,i)=>{e.preventDefault();let o=s.querySelector('input[type="file"]'),a=o.files;if(a){let{metaData:c,identifier:l}=await K(a,n,r,i,o);return{value:null,files:c,event:`${r}/upload/token`,metadata:{identifier:l,type:"UPLOAD_REQUEST"}}}return null})},Ne=(n,t)=>{t("[pond-drop-upload]","drop",async(e,s,r,i)=>{var a;let o=(a=e.dataTransfer)==null?void 0:a.items;if(o){let{metaData:c,identifier:l}=await K(o,n,r,i,s);return{value:null,files:c,event:`${r}/upload/token`,metadata:{identifier:l,type:"UPLOAD_REQUEST"}}}return null})},X=(n,t)=>{Ce(t),Fe(n,t),Ne(n,t)};var Re=async(n,t,e,s,r)=>{r.preventDefault();let i=t.replace("[","").replace("]",""),o=s.closest("[pond-router]"),a=s.getAttribute(i),c=s.getAttribute("pond-data-id");if(o&&a){let l=o.getAttribute("pond-router");if(l){let u=await e(r,s,l,a);u&&(u.event?N(n,u.event,D(H({},u),{dataId:c,type:a})):F(n,l,D(H({},u),{dataId:c,type:a})))}}},Q=(n,t)=>(e,s,r)=>{t.addEventListener(e,s,async(i,o)=>{await Re(n,e,r,i,o)})};var v=class{constructor(){this._subscribers=new Set}subscribe(t){return this._subscribers.add(t),{unsubscribe:()=>{this._subscribers.delete(t)}}}publish(t){let e;for(let s of this._subscribers)try{if(e=s(t),e)break}catch(r){throw r}return e}clear(){this._subscribers.clear()}},E=class extends v{constructor(e){super();this._value=e}get value(){return this._value}get observers(){return this._subscribers}subscribe(e){return e(this._value),super.subscribe(e)}publish(e){if(this._value!==e)return this._value=e,super.publish(e)}};var S=class{constructor(t,e,s,r){this._name=t,this._joinParams=r||{},this._broadcaster=s,this._connection=new E(!1),this._receiver=new v,this._presence=new E({action:"REMOVE_FROM_POND",change:null,presence:[]}),this._subscription=e.subscribe(i=>{i.channelName===t&&(this._receiver.publish(i),this._connection.publish(!0))})}join(){let t={action:"JOIN_CHANNEL",channelName:this._name,event:"JOIN_CHANNEL",payload:this._joinParams};this._receiver.subscribe(e=>{if(e.action==="PRESENCE"){let s=e.event,r=e.payload;this._presence.publish({action:s,change:r.change,presence:r.presence})}}),this._broadcaster.publish(t)}leave(){let t={action:"LEAVE_CHANNEL",channelName:this._name,event:"LEAVE_CHANNEL",payload:{}};this._broadcaster.publish(t),this._connection.publish(!1),this._subscription.unsubscribe(),this._connection.clear(),this._receiver.clear(),this._presence.clear()}onMessage(t,e){return this._receiver.subscribe(s=>{s.action==="MESSAGE"&&s.event===t&&e(s.payload)})}broadcast(t,e){let s={action:"BROADCAST",channelName:this._name,payload:e,event:t};this._broadcaster.publish(s)}broadcastFrom(t,e){let s={action:"BROADCAST_FROM",channelName:this._name,payload:e,event:t};this._broadcaster.publish(s)}sendMessage(t,e,s){let r={action:"SEND_MESSAGE_TO_USER",channelName:this._name,payload:e,event:t,addresses:s};this._broadcaster.publish(r)}updatePresence(t){let e={action:"UPDATE_PRESENCE",channelName:this._name,payload:t,event:"UPDATE_PRESENCE"};this._broadcaster.publish(e)}onJoin(t){return this._presence.subscribe(e=>{e.action==="ADD_TO_POND"&&t(e.change)})}onLeave(t){let e=[];return this._presence.subscribe(s=>{s.action==="REMOVE_FROM_POND"&&e.filter(i=>!s.presence.find(o=>o.id===i.id)).forEach(i=>t(i)),e=s.presence})}get presence(){return this._presence.value.presence}onConnectionChange(t){return this._connection.subscribe(e=>{t(e)})}};var T=class{constructor(t,e){let s;try{s=new URL(t)}catch(o){s=new URL(window.location.toString()),s.pathname=t}let r=new URLSearchParams(e);s.search=r.toString();let i=s.protocol==="https:"?"wss:":"ws:";s.protocol!=="wss:"&&s.protocol!=="ws:"&&(s.protocol=i),this.address=s,this._socketState="CLOSED",this._channels={},this._broadcaster=new v,this._receiver=new v}getState(){return this._socketState}connect(t=1){let e=new WebSocket(this.address.toString()),s=this._receiver.subscribe(r=>{e.send(JSON.stringify(r))});e.onopen=()=>{this._socketState="OPEN"},e.onclose=()=>{this._socketState="CLOSED",s.unsubscribe()},e.onmessage=r=>{let i=JSON.parse(r.data);this._broadcaster.publish(i)},e.onerror=()=>{this._socketState="CLOSED",s.unsubscribe(),setTimeout(()=>{this.connect(t*2)},t*1e3)},this._socket=e}disconnect(){var t;Object.values(this._channels).forEach(e=>e.leave()),this._socketState="CLOSED",this._broadcaster.clear(),this._receiver.clear(),(t=this._socket)==null||t.close(),this._channels={}}onMessage(t,e){return this._broadcaster.subscribe(s=>{s.action==="MESSAGE"&&s.event===t&&e(s.payload)})}createChannel(t,e){if(this._channels[t])return this._channels[t];let s=new S(t,this._broadcaster,this._receiver,e);return this._channels[t]=s,s}};var Y=()=>{let n=new T("/live");n.connect(),n.onMessage("token",t=>{window.token=t.csrfToken;let e=new M,s=n.createChannel(`/${t.nanoId}`,{clientId:t.csrfToken});s.join();let r=!1;s.onConnectionChange(i=>{if(i){let o=Q(s,e);W(s,e),q(o),$(o),G(o),O(e),B(s),X(s,o),r||(r=!0,p("pondReady",s))}})})};window.addEventListener("load",()=>{Y()});})();
