(()=>{var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};function e(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var n=function(){return n=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},n.apply(this,arguments)};function r(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{u(r.next(t))}catch(t){i(t)}}function c(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,c)}u((r=r.apply(t,e||[])).next())}))}function o(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}Object.create;function i(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function s(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function c(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))}function u(t){return this instanceof u?(this.v=t,this):new u(t)}function a(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(t,e||[]),i=[];return r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r;function s(t){o[t]&&(r[t]=function(e){return new Promise((function(n,r){i.push([t,e,n,r])>1||c(t,e)}))})}function c(t,e){try{(n=o[t](e)).value instanceof u?Promise.resolve(n.value.v).then(a,l):d(i[0][2],n)}catch(t){d(i[0][3],t)}var n}function a(t){c("next",t)}function l(t){c("throw",t)}function d(t,e){t(e),i.shift(),i.length&&c(i[0][0],i[0][1])}}function l(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t=i(t),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(n){e[n]=t[n]&&function(e){return new Promise((function(r,o){(function(t,e,n,r){Promise.resolve(r).then((function(e){t({value:e,done:n})}),e)})(r,o,(e=t[n](e)).done,e.value)}))}}}Object.create;function d(t){return"function"==typeof t}function h(t){var e=t((function(t){Error.call(t),t.stack=(new Error).stack}));return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var f=h((function(t){return function(e){t(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}}));function p(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var b=function(){function t(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}var e;return t.prototype.unsubscribe=function(){var t,e,n,r,o;if(!this.closed){this.closed=!0;var u=this._parentage;if(u)if(this._parentage=null,Array.isArray(u))try{for(var a=i(u),l=a.next();!l.done;l=a.next()){l.value.remove(this)}}catch(e){t={error:e}}finally{try{l&&!l.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}else u.remove(this);var h=this.initialTeardown;if(d(h))try{h()}catch(t){o=t instanceof f?t.errors:[t]}var p=this._finalizers;if(p){this._finalizers=null;try{for(var b=i(p),v=b.next();!v.done;v=b.next()){var y=v.value;try{m(y)}catch(t){o=null!=o?o:[],t instanceof f?o=c(c([],s(o)),s(t.errors)):o.push(t)}}}catch(t){n={error:t}}finally{try{v&&!v.done&&(r=b.return)&&r.call(b)}finally{if(n)throw n.error}}}if(o)throw new f(o)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)m(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(e)}},t.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},t.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},t.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&p(e,t)},t.prototype.remove=function(e){var n=this._finalizers;n&&p(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=((e=new t).closed=!0,e),t}(),v=b.EMPTY;function y(t){return t instanceof b||t&&"closed"in t&&d(t.remove)&&d(t.add)&&d(t.unsubscribe)}function m(t){d(t)?t():t.unsubscribe()}var _={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},g={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=g.delegate;return(null==o?void 0:o.setTimeout)?o.setTimeout.apply(o,c([t,e],s(n))):setTimeout.apply(void 0,c([t,e],s(n)))},clearTimeout:function(t){var e=g.delegate;return((null==e?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0};function w(t){g.setTimeout((function(){var e=_.onUnhandledError;if(!e)throw t;e(t)}))}function S(){}var E=x("C",void 0,void 0);function A(t){return x("N",t,void 0)}function x(t,e,n){return{kind:t,value:e,error:n}}var O=null;function N(t){if(_.useDeprecatedSynchronousErrorHandling){var e=!O;if(e&&(O={errorThrown:!1,error:null}),t(),e){var n=O,r=n.errorThrown,o=n.error;if(O=null,r)throw o}}else t()}var k=function(t){function n(e){var n=t.call(this)||this;return n.isStopped=!1,e?(n.destination=e,y(e)&&e.add(n)):n.destination=L,n}return e(n,t),n.create=function(t,e,n){return new D(t,e,n)},n.prototype.next=function(t){this.isStopped?j(A(t),this):this._next(t)},n.prototype.error=function(t){this.isStopped?j(x("E",void 0,t),this):(this.isStopped=!0,this._error(t))},n.prototype.complete=function(){this.isStopped?j(E,this):(this.isStopped=!0,this._complete())},n.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},n.prototype._next=function(t){this.destination.next(t)},n.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},n.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},n}(b),T=Function.prototype.bind;function C(t,e){return T.call(t,e)}var P=function(){function t(t){this.partialObserver=t}return t.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(t){R(t)}},t.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(t){R(t)}else R(t)},t.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(t){R(t)}},t}(),D=function(t){function n(e,n,r){var o,i,s=t.call(this)||this;d(e)||!e?o={next:null!=e?e:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:s&&_.useDeprecatedNextContext?((i=Object.create(e)).unsubscribe=function(){return s.unsubscribe()},o={next:e.next&&C(e.next,i),error:e.error&&C(e.error,i),complete:e.complete&&C(e.complete,i)}):o=e;return s.destination=new P(o),s}return e(n,t),n}(k);function R(t){var e;_.useDeprecatedSynchronousErrorHandling?(e=t,_.useDeprecatedSynchronousErrorHandling&&O&&(O.errorThrown=!0,O.error=e)):w(t)}function j(t,e){var n=_.onStoppedNotification;n&&g.setTimeout((function(){return n(t,e)}))}var L={closed:!0,next:S,error:function(t){throw t},complete:S},I="function"==typeof Symbol&&Symbol.observable||"@@observable";function M(t){return t}function F(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return U(t)}function U(t){return 0===t.length?M:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}var H=function(){function t(t){t&&(this._subscribe=t)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(t,e,n){var r,o=this,i=(r=t)&&r instanceof k||function(t){return t&&d(t.next)&&d(t.error)&&d(t.complete)}(r)&&y(r)?t:new D(t,e,n);return N((function(){var t=o,e=t.operator,n=t.source;i.add(e?e.call(i,n):n?o._subscribe(i):o._trySubscribe(i))})),i},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},t.prototype.forEach=function(t,e){var n=this;return new(e=V(e))((function(e,r){var o=new D({next:function(e){try{t(e)}catch(t){r(t),o.unsubscribe()}},error:r,complete:e});n.subscribe(o)}))},t.prototype._subscribe=function(t){var e;return null===(e=this.source)||void 0===e?void 0:e.subscribe(t)},t.prototype[I]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return U(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=V(t))((function(t,n){var r;e.subscribe((function(t){return r=t}),(function(t){return n(t)}),(function(){return t(r)}))}))},t.create=function(e){return new t(e)},t}();function V(t){var e;return null!==(e=null!=t?t:_.Promise)&&void 0!==e?e:Promise}var $=h((function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),z=function(t){function n(){var e=t.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return e(n,t),n.prototype.lift=function(t){var e=new W(this,this);return e.operator=t,e},n.prototype._throwIfClosed=function(){if(this.closed)throw new $},n.prototype.next=function(t){var e=this;N((function(){var n,r;if(e._throwIfClosed(),!e.isStopped){e.currentObservers||(e.currentObservers=Array.from(e.observers));try{for(var o=i(e.currentObservers),s=o.next();!s.done;s=o.next()){s.value.next(t)}}catch(t){n={error:t}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}}}))},n.prototype.error=function(t){var e=this;N((function(){if(e._throwIfClosed(),!e.isStopped){e.hasError=e.isStopped=!0,e.thrownError=t;for(var n=e.observers;n.length;)n.shift().error(t)}}))},n.prototype.complete=function(){var t=this;N((function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var e=t.observers;e.length;)e.shift().complete()}}))},n.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(n.prototype,"observed",{get:function(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0},enumerable:!1,configurable:!0}),n.prototype._trySubscribe=function(e){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,e)},n.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},n.prototype._innerSubscribe=function(t){var e=this,n=this,r=n.hasError,o=n.isStopped,i=n.observers;return r||o?v:(this.currentObservers=null,i.push(t),new b((function(){e.currentObservers=null,p(i,t)})))},n.prototype._checkFinalizedStatuses=function(t){var e=this,n=e.hasError,r=e.thrownError,o=e.isStopped;n?t.error(r):o&&t.complete()},n.prototype.asObservable=function(){var t=new H;return t.source=this,t},n.create=function(t,e){return new W(t,e)},n}(H),W=function(t){function n(e,n){var r=t.call(this)||this;return r.destination=e,r.source=n,r}return e(n,t),n.prototype.next=function(t){var e,n;null===(n=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===n||n.call(e,t)},n.prototype.error=function(t){var e,n;null===(n=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===n||n.call(e,t)},n.prototype.complete=function(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)},n.prototype._subscribe=function(t){var e,n;return null!==(n=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==n?n:v},n}(z),B={now:function(){return(B.delegate||Date).now()},delegate:void 0},G=function(t){function n(e,n,r){void 0===e&&(e=1/0),void 0===n&&(n=1/0),void 0===r&&(r=B);var o=t.call(this)||this;return o._bufferSize=e,o._windowTime=n,o._timestampProvider=r,o._buffer=[],o._infiniteTimeWindow=!0,o._infiniteTimeWindow=n===1/0,o._bufferSize=Math.max(1,e),o._windowTime=Math.max(1,n),o}return e(n,t),n.prototype.next=function(e){var n=this,r=n.isStopped,o=n._buffer,i=n._infiniteTimeWindow,s=n._timestampProvider,c=n._windowTime;r||(o.push(e),!i&&o.push(s.now()+c)),this._trimBuffer(),t.prototype.next.call(this,e)},n.prototype._subscribe=function(t){this._throwIfClosed(),this._trimBuffer();for(var e=this._innerSubscribe(t),n=this._infiniteTimeWindow,r=this._buffer.slice(),o=0;o<r.length&&!t.closed;o+=n?1:2)t.next(r[o]);return this._checkFinalizedStatuses(t),e},n.prototype._trimBuffer=function(){var t=this,e=t._bufferSize,n=t._timestampProvider,r=t._buffer,o=t._infiniteTimeWindow,i=(o?1:2)*e;if(e<1/0&&i<r.length&&r.splice(0,r.length-i),!o){for(var s=n.now(),c=0,u=1;u<r.length&&r[u]<=s;u+=2)c=u;c&&r.splice(0,c+1)}},n}(z),q={url:"",deserializer:function(t){return JSON.parse(t.data)},serializer:function(t){return JSON.stringify(t)}},J=function(t){function r(e,r){var o=t.call(this)||this;if(o._socket=null,e instanceof H)o.destination=r,o.source=e;else{var i=o._config=n({},q);if(o._output=new z,"string"==typeof e)i.url=e;else for(var s in e)e.hasOwnProperty(s)&&(i[s]=e[s]);if(!i.WebSocketCtor&&WebSocket)i.WebSocketCtor=WebSocket;else if(!i.WebSocketCtor)throw new Error("no WebSocket constructor can be found");o.destination=new G}return o}return e(r,t),r.prototype.lift=function(t){var e=new r(this._config,this.destination);return e.operator=t,e.source=this,e},r.prototype._resetState=function(){this._socket=null,this.source||(this.destination=new G),this._output=new z},r.prototype.multiplex=function(t,e,n){var r=this;return new H((function(o){try{r.next(t())}catch(t){o.error(t)}var i=r.subscribe({next:function(t){try{n(t)&&o.next(t)}catch(t){o.error(t)}},error:function(t){return o.error(t)},complete:function(){return o.complete()}});return function(){try{r.next(e())}catch(t){o.error(t)}i.unsubscribe()}}))},r.prototype._connectSocket=function(){var t=this,e=this._config,n=e.WebSocketCtor,r=e.protocol,o=e.url,i=e.binaryType,s=this._output,c=null;try{c=r?new n(o,r):new n(o),this._socket=c,i&&(this._socket.binaryType=i)}catch(t){return void s.error(t)}var u=new b((function(){t._socket=null,c&&1===c.readyState&&c.close()}));c.onopen=function(e){if(!t._socket)return c.close(),void t._resetState();var n=t._config.openObserver;n&&n.next(e);var r=t.destination;t.destination=k.create((function(e){if(1===c.readyState)try{var n=t._config.serializer;c.send(n(e))}catch(e){t.destination.error(e)}}),(function(e){var n=t._config.closingObserver;n&&n.next(void 0),e&&e.code?c.close(e.code,e.reason):s.error(new TypeError("WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }")),t._resetState()}),(function(){var e=t._config.closingObserver;e&&e.next(void 0),c.close(),t._resetState()})),r&&r instanceof G&&u.add(r.subscribe(t.destination))},c.onerror=function(e){t._resetState(),s.error(e)},c.onclose=function(e){c===t._socket&&t._resetState();var n=t._config.closeObserver;n&&n.next(e),e.wasClean?s.complete():s.error(e)},c.onmessage=function(e){try{var n=t._config.deserializer;s.next(n(e))}catch(t){s.error(t)}}},r.prototype._subscribe=function(t){var e=this,n=this.source;return n?n.subscribe(t):(this._socket||this._connectSocket(),this._output.subscribe(t),t.add((function(){var t=e._socket;0===e._output.observers.length&&(!t||1!==t.readyState&&0!==t.readyState||t.close(),e._resetState())})),t)},r.prototype.unsubscribe=function(){var e=this._socket;!e||1!==e.readyState&&0!==e.readyState||e.close(),this._resetState(),t.prototype.unsubscribe.call(this)},r}(W);function K(t){return function(e){if(function(t){return d(null==t?void 0:t.lift)}(e))return e.lift((function(e){try{return t(e,this)}catch(t){this.error(t)}}));throw new TypeError("Unable to lift unknown Observable type")}}function Y(t,e,n,r,o){return new X(t,e,n,r,o)}var X=function(t){function n(e,n,r,o,i,s){var c=t.call(this,e)||this;return c.onFinalize=i,c.shouldUnsubscribe=s,c._next=n?function(t){try{n(t)}catch(t){e.error(t)}}:t.prototype._next,c._error=o?function(t){try{o(t)}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._error,c._complete=r?function(){try{r()}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._complete,c}return e(n,t),n.prototype.unsubscribe=function(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;t.prototype.unsubscribe.call(this),!n&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}},n}(k);function Q(t,e){return K((function(n,r){var o=0;n.subscribe(Y(r,(function(n){r.next(t.call(e,n,o++))})))}))}var Z=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function tt(t){return d(null==t?void 0:t.then)}function et(t){return d(t[I])}function nt(t){return Symbol.asyncIterator&&d(null==t?void 0:t[Symbol.asyncIterator])}function rt(t){return new TypeError("You provided "+(null!==t&&"object"==typeof t?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var ot="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function it(t){return d(null==t?void 0:t[ot])}function st(t){return a(this,arguments,(function(){var e,n,r;return o(this,(function(o){switch(o.label){case 0:e=t.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,u(e.read())];case 3:return n=o.sent(),r=n.value,n.done?[4,u(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,u(r)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}}))}))}function ct(t){return d(null==t?void 0:t.getReader)}function ut(t){if(t instanceof H)return t;if(null!=t){if(et(t))return o=t,new H((function(t){var e=o[I]();if(d(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(Z(t))return r=t,new H((function(t){for(var e=0;e<r.length&&!t.closed;e++)t.next(r[e]);t.complete()}));if(tt(t))return n=t,new H((function(t){n.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,w)}));if(nt(t))return at(t);if(it(t))return e=t,new H((function(t){var n,r;try{for(var o=i(e),s=o.next();!s.done;s=o.next()){var c=s.value;if(t.next(c),t.closed)return}}catch(t){n={error:t}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}t.complete()}));if(ct(t))return at(st(t))}var e,n,r,o;throw rt(t)}function at(t){return new H((function(e){(function(t,e){var n,i,s,c;return r(this,void 0,void 0,(function(){var r,u;return o(this,(function(o){switch(o.label){case 0:o.trys.push([0,5,6,11]),n=l(t),o.label=1;case 1:return[4,n.next()];case 2:if((i=o.sent()).done)return[3,4];if(r=i.value,e.next(r),e.closed)return[2];o.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return u=o.sent(),s={error:u},[3,11];case 6:return o.trys.push([6,,9,10]),i&&!i.done&&(c=n.return)?[4,c.call(n)]:[3,8];case 7:o.sent(),o.label=8;case 8:return[3,10];case 9:if(s)throw s.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}}))}))})(t,e).catch((function(t){return e.error(t)}))}))}function lt(t,e,n,r,o){void 0===r&&(r=0),void 0===o&&(o=!1);var i=e.schedule((function(){n(),o?t.add(this.schedule(null,r)):this.unsubscribe()}),r);if(t.add(i),!o)return i}function dt(t,e,n,r,o,i,s,c){var u=[],a=0,l=0,d=!1,h=function(){!d||u.length||a||e.complete()},f=function(t){return a<r?p(t):u.push(t)},p=function(t){i&&e.next(t),a++;var c=!1;ut(n(t,l++)).subscribe(Y(e,(function(t){null==o||o(t),i?f(t):e.next(t)}),(function(){c=!0}),void 0,(function(){if(c)try{a--;for(var t=function(){var t=u.shift();s?lt(e,s,(function(){return p(t)})):p(t)};u.length&&a<r;)t();h()}catch(t){e.error(t)}})))};return t.subscribe(Y(e,f,(function(){d=!0,h()}))),function(){null==c||c()}}function ht(t,e,n){return void 0===n&&(n=1/0),d(e)?ht((function(n,r){return Q((function(t,o){return e(n,t,r,o)}))(ut(t(n,r)))}),n):("number"==typeof e&&(n=e),K((function(e,r){return dt(e,r,t,n)})))}function ft(){return void 0===(t=1)&&(t=1/0),ht(M,t);var t}function pt(t){return t&&d(t.schedule)}function bt(t){return t[t.length-1]}function vt(t){return d(bt(t))?t.pop():void 0}function yt(t){return pt(bt(t))?t.pop():void 0}function mt(t,e){return void 0===e&&(e=0),K((function(n,r){n.subscribe(Y(r,(function(n){return lt(r,t,(function(){return r.next(n)}),e)}),(function(){return lt(r,t,(function(){return r.complete()}),e)}),(function(n){return lt(r,t,(function(){return r.error(n)}),e)})))}))}function _t(t,e){return void 0===e&&(e=0),K((function(n,r){r.add(t.schedule((function(){return n.subscribe(r)}),e))}))}function gt(t,e){return ut(t).pipe(_t(e),mt(e))}function wt(t,e){return ut(t).pipe(_t(e),mt(e))}function St(t,e){return new H((function(n){var r=0;return e.schedule((function(){r===t.length?n.complete():(n.next(t[r++]),n.closed||this.schedule())}))}))}function Et(t,e){return new H((function(n){var r;return lt(n,e,(function(){r=t[ot](),lt(n,e,(function(){var t,e,o;try{e=(t=r.next()).value,o=t.done}catch(t){return void n.error(t)}o?n.complete():n.next(e)}),0,!0)})),function(){return d(null==r?void 0:r.return)&&r.return()}}))}function At(t,e){if(!t)throw new Error("Iterable cannot be null");return new H((function(n){lt(n,e,(function(){var r=t[Symbol.asyncIterator]();lt(n,e,(function(){r.next().then((function(t){t.done?n.complete():n.next(t.value)}))}),0,!0)}))}))}function xt(t,e){return At(st(t),e)}function Ot(t,e){if(null!=t){if(et(t))return gt(t,e);if(Z(t))return St(t,e);if(tt(t))return wt(t,e);if(nt(t))return At(t,e);if(it(t))return Et(t,e);if(ct(t))return xt(t,e)}throw rt(t)}function Nt(t,e){return e?Ot(t,e):ut(t)}function kt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return ft()(Nt(t,yt(t)))}var Tt=new H((function(t){return t.complete()}));function Ct(t,e){var n=d(t)?t:function(){return t},r=function(t){return t.error(n())};return new H(e?function(t){return e.schedule(r,0,t)}:r)}var Pt=function(t){function n(e,n){return t.call(this)||this}return e(n,t),n.prototype.schedule=function(t,e){return void 0===e&&(e=0),this},n}(b),Dt={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=Dt.delegate;return(null==o?void 0:o.setInterval)?o.setInterval.apply(o,c([t,e],s(n))):setInterval.apply(void 0,c([t,e],s(n)))},clearInterval:function(t){var e=Dt.delegate;return((null==e?void 0:e.clearInterval)||clearInterval)(t)},delegate:void 0},Rt=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.scheduler=e,r.work=n,r.pending=!1,r}return e(n,t),n.prototype.schedule=function(t,e){if(void 0===e&&(e=0),this.closed)return this;this.state=t;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(r,this.id,e),this},n.prototype.requestAsyncId=function(t,e,n){return void 0===n&&(n=0),Dt.setInterval(t.flush.bind(t,this),n)},n.prototype.recycleAsyncId=function(t,e,n){if(void 0===n&&(n=0),null!=n&&this.delay===n&&!1===this.pending)return e;Dt.clearInterval(e)},n.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(t,e);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},n.prototype._execute=function(t,e){var n,r=!1;try{this.work(t)}catch(t){r=!0,n=t||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),n},n.prototype.unsubscribe=function(){if(!this.closed){var e=this.id,n=this.scheduler,r=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,p(r,this),null!=e&&(this.id=this.recycleAsyncId(n,e,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},n}(Pt),jt=function(){function t(e,n){void 0===n&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(t,e,n){return void 0===e&&(e=0),new this.schedulerActionCtor(this,t).schedule(n,e)},t.now=B.now,t}(),Lt=new(function(t){function n(e,n){void 0===n&&(n=jt.now);var r=t.call(this,e,n)||this;return r.actions=[],r._active=!1,r._scheduled=void 0,r}return e(n,t),n.prototype.flush=function(t){var e=this.actions;if(this._active)e.push(t);else{var n;this._active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=e.shift());if(this._active=!1,n){for(;t=e.shift();)t.unsubscribe();throw n}}},n}(jt))(Rt),It=Lt;function Mt(t,e,n){void 0===t&&(t=0),void 0===n&&(n=It);var r=-1;return null!=e&&(pt(e)?n=e:r=e),new H((function(e){var o,i=(o=t)instanceof Date&&!isNaN(o)?+t-n.now():t;i<0&&(i=0);var s=0;return n.schedule((function(){e.closed||(e.next(s++),0<=r?this.schedule(void 0,r):e.complete())}),i)}))}var Ft,Ut,Ht=Array.isArray;function Vt(t){return 1===t.length&&Ht(t[0])?t[0]:t}function $t(t){return t<=0?function(){return Tt}:K((function(e,n){var r=0;e.subscribe(Y(n,(function(e){++r<=t&&(n.next(e),t<=r&&n.complete())})))}))}function zt(t){return Q((function(){return t}))}function Wt(t,e){return e?function(n){return kt(e.pipe($t(1),K((function(t,e){t.subscribe(Y(e,S))}))),n.pipe(Wt(t)))}:ht((function(e,n){return t(e,n).pipe($t(1),zt(e))}))}function Bt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=yt(t);return Nt(t,n)}(Ut=Ft||(Ft={})).NEXT="N",Ut.ERROR="E",Ut.COMPLETE="C";var Gt=function(){function t(t,e,n){this.kind=t,this.value=e,this.error=n,this.hasValue="N"===t}return t.prototype.observe=function(t){return qt(this,t)},t.prototype.do=function(t,e,n){var r=this,o=r.kind,i=r.value,s=r.error;return"N"===o?null==t?void 0:t(i):"E"===o?null==e?void 0:e(s):null==n?void 0:n()},t.prototype.accept=function(t,e,n){var r;return d(null===(r=t)||void 0===r?void 0:r.next)?this.observe(t):this.do(t,e,n)},t.prototype.toObservable=function(){var t=this,e=t.kind,n=t.value,r=t.error,o="N"===e?Bt(n):"E"===e?Ct((function(){return r})):"C"===e?Tt:0;if(!o)throw new TypeError("Unexpected notification kind "+e);return o},t.createNext=function(e){return new t("N",e)},t.createError=function(e){return new t("E",void 0,e)},t.createComplete=function(){return t.completeNotification},t.completeNotification=new t("C"),t}();function qt(t,e){var n,r,o,i=t,s=i.kind,c=i.value,u=i.error;if("string"!=typeof s)throw new TypeError('Invalid notification, missing "kind"');"N"===s?null===(n=e.next)||void 0===n||n.call(e,c):"E"===s?null===(r=e.error)||void 0===r||r.call(e,u):null===(o=e.complete)||void 0===o||o.call(e)}class Jt{_subscribers=new Set;subscribe(t){return this._subscribers.add(t),{unsubscribe:()=>{this._subscribers.delete(t)}}}publish(t){let e;for(const n of this._subscribers)if(e=n(t),e)break;return e}}class Kt extends Jt{constructor(t){super(),this._value=t}get value(){return this._value}subscribe(t){return t(this._value),super.subscribe(t)}publish(t){if(this._value!==t)return this._value=t,super.publish(t)}}let Yt;var Xt;let Qt;var Zt;let te;var ee;let ne;var re;let oe;var ie;let se;var ce;(Xt=Yt||(Yt={})).POND="POND",Xt.CHANNEL="CHANNEL",(Zt=Qt||(Qt={})).ERROR="ERROR",Zt.MESSAGE="MESSAGE",Zt.PRESENCE="PRESENCE",Zt.CLOSE="CLOSE",(ee=te||(te={})).JOIN_CHANNEL="JOIN_CHANNEL",ee.LEAVE_CHANNEL="LEAVE_CHANNEL",ee.UPDATE_PRESENCE="UPDATE_PRESENCE",ee.BROADCAST_FROM="BROADCAST_FROM",ee.BROADCAST="BROADCAST",ee.SEND_MESSAGE_TO_USER="SEND_MESSAGE_TO_USER",(re=ne||(ne={})).BROADCAST="BROADCAST",re.BROADCAST_FROM="BROADCAST_FROM",re.SEND_MESSAGE_TO_USER="SEND_MESSAGE_TO_USER",(ie=oe||(oe={})).ADD_TO_POND="ADD_TO_POND",ie.REMOVE_FROM_POND="REMOVE_FROM_POND",ie.UPDATE_IN_POND="UPDATE_IN_POND",(ce=se||(se={})).SERVER="SERVER",ce.ENDPOINT="ENDPOINT",ce.POND_CHANNEL="POND_CHANNEL";class ue{constructor(t,e,n){this.errorMessage=t,this.errorCode=e,this.data=n,console.log("PondError: ",this.errorMessage)}}class ae{constructor(t,e,n,r){this._id=t,this._doc=e,this._removeDoc=n,this._updateDoc=r}get id(){return this._id}get doc(){return this._doc}removeDoc(){return this._removeDoc(),this._doc}updateDoc(t){this._doc=this._updateDoc(t).doc}}class le{constructor(){this._db={},this._broadcast=new Jt}get size(){return Object.keys(this._db).length}get(t){const e=this._db[t];return e?this._createPondDocument(t,e):null}set(t){const e=this._nanoid();return this._db[e]=t,this._broadcast.publish({oldValue:null,currentValue:t}),this._createPondDocument(e,t)}update(t,e){if(this._db[t])return this._db[t]=e,this._broadcast.publish({oldValue:this._db[t],currentValue:e}),this._createPondDocument(t,e);throw new ue(`Key ${t} does not exist in the pond`,404,t)}createDocument(t){let e=this._createPondDocument(this._nanoid(),void 0);const n=t(e);return this._db[e.id]=n,e.updateDoc(n),this._broadcast.publish({oldValue:null,currentValue:n}),e}merge(t){for(const e in t._db)this._db[e]=t._db[e];return this}*generate(){for(const t in this._db)yield this._db[t]}query(t){const e=[];for(const n in this._db){const r=this._db[n];t(r)&&e.push(this._createPondDocument(n,r))}return e}queryById(t){const e=[];for(const n in this._db)t(n)&&e.push(this._createPondDocument(n,this._db[n]));return e}queryByKeys(t){return t.map((t=>this.get(t))).filter((t=>null!==t))}reduce(t,e){let n=0;for(const r in this._db)e=t(e,this._db[r],n),n++;return e}find(t){for(const e in this._db){const n=this._db[e];if(t(n))return this._createPondDocument(e,n)}return null}map(t){return Object.values(this._db).map(t)}clear(){Object.keys(this._db).forEach((t=>this._delete(t)))}subscribe(t){return this._broadcast.subscribe((e=>{let n=oe.UPDATE_IN_POND;null===e.oldValue?n=oe.ADD_TO_POND:null===e.currentValue&&(n=oe.REMOVE_FROM_POND),t(Object.values(this._db),e.currentValue,n)}))}toArray(){const t=[];for(const e in this._db){const n=this._db[e];t.push(this._createPondDocument(e,n))}return t}_delete(t){delete this._db[t],this._broadcast.publish({oldValue:this._db[t],currentValue:null})}_nanoid=()=>{let t="";const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let n=0;n<21;n++)t+=e.charAt(Math.floor(Math.random()*e.length));return t};_createPondDocument(t,e){const n=this._delete.bind(this,t),r=this.update.bind(this,t);return new ae(t,e,n,r)}}class de{subscriptions=[];presenceSubject=new z;constructor(t,e,n){this.channel=t,this.params=e,this.socket=n,this.subject=new z,this.connectedSubject=new Kt(!1)}get isActive(){return this.connectedSubject.value}join(){if(this.connectedSubject.value)return this;const t=this.init().subscribe((t=>{this.connectedSubject.publish(!0),"PRESENCE"===t.action?this.presenceSubject.next(t.payload.presence):"MESSAGE"===t.action?this.subject.next(t):"KICKED_FROM_CHANNEL"===t.event&&this.leave()}));return this.subscriptions.push(t),this}leave(){this.connectedSubject.publish(!1),this.presenceSubject.complete(),this.subscriptions.forEach((t=>t.unsubscribe())),this.subscriptions=[],this.subject.complete()}onPresenceUpdate(t){const e=this.presenceSubject.subscribe(t);return this.subscriptions.push(e),e}onMessage(t){const e=this.subject.pipe((n=t=>"MESSAGE"===t.action,K((function(t,e){var o=0;t.subscribe(Y(e,(function(t){return n.call(r,t,o++)&&e.next(t)})))})))).subscribe((e=>t(e.event,e.payload)));var n,r;return this.subscriptions.push(e),e}broadcast(t,e){const n={channelName:this.channel,payload:e,event:t,action:te.BROADCAST};this.socket.next(n)}broadcastFrom(t,e){const n={channelName:this.channel,payload:e,event:t,action:te.BROADCAST_FROM};this.socket.next(n)}updatePresence(t){this.socket.next({action:te.UPDATE_PRESENCE,channelName:this.channel,event:"PRESENCE",payload:t})}sendMessage(t,e,n){const r=Array.isArray(n)?n:[n],o={channelName:this.channel,payload:e,event:t,addresses:r,action:te.SEND_MESSAGE_TO_USER};this.socket.next(o)}onConnectionChange(t){const e=this.connectedSubject.subscribe(t);return this.subscriptions.push(e),e}init(){return this.socket.multiplex((()=>({action:"JOIN_CHANNEL",channelName:this.channel,event:"JOIN_CHANNEL",payload:this.params})),(()=>({action:"LEAVE_CHANNEL",channelName:this.channel,event:"LEAVE_CHANNEL",payload:this.params})),(t=>t.channelName===this.channel))}}class he{socketState="CLOSED";constructor(t,e){let n;try{n=new URL(t)}catch(e){n=new URL(window.location.toString()),n.pathname=t}const r=new URLSearchParams(e);n.search=r.toString();const o="https:"===n.protocol?"wss:":"ws:";"wss:"!==n.protocol&&"ws:"!==n.protocol&&(n.protocol=o),this.address=n,this.channels=new le}connect(){if("CLOSED"!==this.socketState)return;this.socketState="CONNECTING";const t=(e={url:this.address.toString(),openObserver:{next:()=>{this.socketState="OPEN"}},closeObserver:{next:()=>{this.socketState="CLOSED"}},closingObserver:{next:()=>{this.socketState="CLOSING"}}},new J(e));var e;return this.socket=t,this.subscription=t.pipe(this._retryStrategy(100,1e3)).subscribe(),this}getState(){return this.socketState}createChannel(t,e){const n=this.channels.find((e=>e.channel===t));if(n)return n.doc;const r=new de(t,e||{},this.socket);return this.channels.set(r),r}disconnect(){this.socket?.complete(),this.socket?.unsubscribe(),this.subscription?.unsubscribe(),this.socket=void 0,this.channels=new le}_retryStrategy=(t,e)=>{return F((n=n=>{var r,o;return kt(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=vt(t),r=Vt(t);return r.length?new H((function(t){var e=r.map((function(){return[]})),o=r.map((function(){return!1}));t.add((function(){e=o=null}));for(var i=function(i){ut(r[i]).subscribe(Y(t,(function(r){if(e[i].push(r),e.every((function(t){return t.length}))){var u=e.map((function(t){return t.shift()}));t.next(n?n.apply(void 0,c([],s(u))):u),e.some((function(t,e){return!t.length&&o[e]}))&&t.complete()}}),(function(){o[i]=!0,!e[i].length&&t.complete()})))},u=0;!t.closed&&u<r.length;u++)i(u);return function(){e=o=null}})):Tt}(function(t,e,n){if(null==e&&(e=t,t=0),e<=0)return Tt;var r=e+t;return new H(n?function(e){var o=t;return n.schedule((function(){o<r?(e.next(o++),this.schedule()):e.complete()}))}:function(e){for(var n=t;n<r&&!e.closed;)e.next(n++);e.complete()})}(1,t),n).pipe(Q((([t,e])=>t)),Q((t=>t*t)),(r=t=>Mt(t*e),K((function(t,e){var n=null,i=0,s=!1,c=function(){return s&&!n&&e.complete()};t.subscribe(Y(e,(function(t){null==n||n.unsubscribe();var s=0,u=i++;ut(r(t,u)).subscribe(n=Y(e,(function(n){return e.next(o?o(t,n,u,s++):n)}),(function(){n=null,c()})))}),(function(){s=!0,c()})))})))),Ct(new Error("Could not connect to server")).pipe(K((function(t,e){t.subscribe(Y(e,(function(t){e.next(Gt.createNext(t))}),(function(){e.next(Gt.createComplete()),e.complete()}),(function(t){e.next(Gt.createError(t)),e.complete()})))})),function(t,e){void 0===e&&(e=Lt);var n=Mt(t,e);return Wt((function(){return n}))}(1e3),K((function(t,e){t.subscribe(Y(e,(function(t){return qt(t,e)})))}))))},K((function(t,e){var r,o,i=!1,s=function(){r=t.subscribe(Y(e,void 0,void 0,(function(t){o||(o=new z,n(o).subscribe(Y(e,(function(){return r?s():i=!0})))),o&&o.next(t)}))),i&&(r.unsubscribe(),r=null,i=!1,s())};s()}))));var n}}const fe=t=>{const e={};for(const n in t)if("created"===t[n].type||"updated"===t[n].type)e[n]=t[n].data;else if("object"==typeof t[n]){const r=fe(t[n]);r&&Object.keys(r).length>0&&(e[n]=r)}return e},pe=(t,e)=>{if(void 0===t)return e;if(void 0===e)return t;for(const n in e)e[n]instanceof Object?t[n]=pe(t[n],e[n]):t[n]=e[n];return t},be=(t,e)=>{const n=t=>"[object Function]"===Object.prototype.toString.call(t),r=t=>"[object Date]"===Object.prototype.toString.call(t),o=t=>!(t=>"[object Object]"===Object.prototype.toString.call(t))(t)&&!(t=>"[object Array]"===Object.prototype.toString.call(t))(t),i=(t,e)=>{if(n(t)||n(e))throw"Invalid argument. Function given, object expected.";if(o(t)||o(e)){const n=(s=t)===(c=e)||r(s)&&r(c)&&s.getTime()===c.getTime()?"unchanged":void 0===s?"created":void 0===c?"deleted":"updated";return"updated"===n?{type:n,data:e}:{type:n,data:void 0===t?e:t}}var s,c;const u={};for(const r in t){if(n(t[r]))continue;let o;void 0!==e[r]&&(o=e[r]),u[r]=i(t[r],o)}for(const t in e)n(e[t])||void 0!==u[t]||(u[t]=i(void 0,e[t]));return u};return i(t,e)},ve={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},ye=new RegExp(Object.keys(ve).join("|"),"g");function me(t,e){return null==e&&(e=","),t.length<=0?new ge([""],[]):new ge(["",...Array(t.length-1).fill(e),""],t)}function _e(t){return t instanceof ge?t.toString():Array.isArray(t)?me(t,"").toString():String(t).replace(ye,(t=>ve[t]))}class ge{constructor(t,e){this.statics=t,this.dynamics=e}toString(){let t=this.statics[0];for(let e=0;e<this.dynamics.length;e++)t+=_e(this.dynamics[e])+this.statics[e+1];return t}getParts(){const t={s:this.statics};for(let e=0;e<this.dynamics.length;e++)if(this.dynamics[e]instanceof ge)t[e]=this.dynamics[e].getParts();else if(Array.isArray(this.dynamics[e]))t[e]=me(this.dynamics[e],"").getParts();else{if(void 0===this.dynamics[e])throw new ue("undefined value in html",500,"render");t[e]=this.dynamics[e]}return t}parsedHtmlToString(t){const e=t;let n="";if(Array.isArray(e))return me(e,"").toString();if(e.s){n=e.s[0];for(let r=0;r<e.s.length-1;r++)"object"==typeof e[r]?n+=this.parsedHtmlToString(t[r])+e.s[r+1]:n+=_e(t[r])+e.s[r+1]}return n}differentiate(t){const e=t.getParts(),n=this.getParts(),r=be(n,e);return fe(r)}}function we(t,...e){return new ge(t,e)}const Se=(t,e,n,r)=>{const o=document.createElement("div");o.innerHTML=e.trim();const i=o.querySelector("#"+n),s=t.querySelector("#"+n);i&&s&&i.replaceWith(s.cloneNode(!0));const c=o.firstElementChild;Ee(t,c),r&&r.pageTitle&&(document.title=r.pageTitle)},Ee=(t,e)=>{if(t instanceof Text&&e instanceof Text&&t.textContent!==e.textContent)return void t.replaceWith(e);if(t instanceof Text&&e instanceof Element)return void t.replaceWith(e);if(t instanceof Element&&e instanceof Text)return void t.replaceWith(e);t.tagName!==e.tagName&&t.replaceWith(e);for(const n in e.attributes){const r=e.attributes[n];r&&r.name&&r.value&&(t.hasAttribute(r.name)&&t.getAttribute(r.name)===r.value||t.setAttribute(r.name,r.value))}for(const n in t.attributes){const r=t.attributes[n];r&&r.name&&r.value&&(e.hasAttribute(r.name)?e.hasAttribute(r.name)&&e.getAttribute(r.name)!==r.value&&t.setAttribute(r.name,e.getAttribute(r.name)):t.removeAttribute(r.name))}const n=Math.max(t.childNodes.length,e.childNodes.length);for(let r=0;r<n;r++){const n=t.childNodes[r],o=e.childNodes[r];if(n&&o)Ee(n,o);else{if(n)return Ae(t,r);o&&t.appendChild(o.cloneNode(!0))}}},Ae=(t,e)=>{const n=t.children;for(let t=n.length-1;t>=e;t--){n[t].remove()}},xe=(t,e)=>{const n={},r={};e.watch("[pond-router]",{onAdd:e=>{const o=e.getAttribute("pond-router");o&&!n[o]&&(n[o]=t.onMessage(((t,n)=>{if(n.path===o){if("rendered"===t){const t=we``;r[o]=n.rendered;const i=t.parsedHtmlToString(n.rendered);Se(e,i,o,n.headers)}if("updated"===t){const t=we``,i=pe(r[o],n.rendered);r[o]=i;const s=t.parsedHtmlToString(i);Se(e,s,o,n.headers)}}})),t.broadcastFrom(`mount/${o}`,{}))},onRemove:e=>{const o=e.getAttribute("pond-router");o&&n[o]&&(t.broadcastFrom(`unmount/${o}`,{}),n[o].unsubscribe(),delete n[o],delete r[o])},onUpdated:e=>{const r=e.getAttribute("pond-router");r&&n[r]&&t.broadcastFrom(`update/${r}`,{})}})};class Oe{_modifiers={};constructor(){const t=new MutationObserver((t=>{for(let e=0;e<t.length;e++){const n=t[e];switch(n.type){case"childList":for(let t=0;t<n.removedNodes.length;t++){const e=n.removedNodes[t];if(e instanceof HTMLElement){const t=e;for(const e in this._modifiers)if(t.matches(e)){this._modifiers[e].forEach((e=>{e.onRemove&&e.onRemove(t)}))}}}for(let t=0;t<n.addedNodes.length;t++){const e=n.addedNodes[t];if(e instanceof HTMLElement){const t=e;for(const e in this._modifiers)if(t.matches(e)){this._modifiers[e].forEach((e=>{e.onAdd&&e.onAdd(t)}))}}}break;case"attributes":const t=n.target,e=`[${n.attributeName}]`;for(const r in this._modifiers)if(e===r||t.matches(r))if(null===n.oldValue){this._modifiers[r].forEach((e=>{e.onAdd&&e.onAdd(t)}))}else{const e=this._modifiers[r],o=t.hasAttribute(n.attributeName);e.forEach((e=>{o?e.onUpdated&&e.onUpdated(t):e.onRemove&&e.onRemove(t)}))}}}}));t.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0}),this._observer=t}watch(t,e){const n=document.querySelectorAll(t);for(let t=0;t<n.length;t++){const r=n[t];e.onAdd&&e.onAdd(r)}const r=this._modifiers[t]||[];r.push(e),this._modifiers[t]=r}unwatch(t){delete this._modifiers[t]}isWatching(t){return!!this._modifiers[t]}addEventListener(t,e,n){this.watch(t,{onAdd:t=>{t.addEventListener(e,n)},onRemove:t=>{t.removeEventListener(e,n)}})}delegateEvent(t,e,n){document.body.addEventListener(e,(e=>{e.target.matches(t)&&n(e)}))}shutdown(){for(const t in this._modifiers)this.unwatch(t);this._observer.disconnect()}}const Ne=(t,e)=>{((t,e)=>{e.addEventListener("[pond-click]","click",(e=>{const n=e.target,r=n.closest("[pond-router]");if(r){const e=r.getAttribute("pond-router"),o=n.getAttribute("pond-click");e&&o&&t.broadcastFrom(`event/${e}`,{type:o})}}))})(t,e),((t,e)=>{e.addEventListener("[pond-mouseenter]","mouseenter",(e=>{const n=e.target,r=n.closest("[pond-router]");if(r){const e=r.getAttribute("pond-router"),o=n.getAttribute("pond-mouseenter");e&&o&&t.broadcastFrom(`event/${e}`,{type:o})}}))})(t,e),((t,e)=>{e.addEventListener("[pond-mouseleave]","mouseleave",(e=>{const n=e.target,r=n.closest("[pond-router]");if(r){const e=r.getAttribute("pond-router"),o=n.getAttribute("pond-mouseleave");e&&o&&t.broadcastFrom(`event/${e}`,{type:o})}}))})(t,e),((t,e)=>{e.addEventListener("[pond-mousemove]","mousemove",(e=>{const n=e.target,r=n.closest("[pond-router]");if(r){const e=r.getAttribute("pond-router"),o=n.getAttribute("pond-mousemove");e&&o&&t.broadcastFrom(`event/${e}`,{type:o})}}))})(t,e),((t,e)=>{e.addEventListener("[pond-mousedown]","mousedown",(e=>{const n=e.target,r=n.closest("[pond-router]");if(r){const e=r.getAttribute("pond-router"),o=n.getAttribute("pond-mousedown");e&&o&&t.broadcastFrom(`event/${e}`,{type:o})}}))})(t,e),((t,e)=>{e.addEventListener("[pond-mouseup]","mouseup",(e=>{const n=e.target,r=n.closest("[pond-router]");if(r){const e=r.getAttribute("pond-router"),o=n.getAttribute("pond-mouseup");e&&o&&t.broadcastFrom(`event/${e}`,{type:o})}}))})(t,e),((t,e)=>{e.addEventListener("[pond-double-click]","dblclick",(e=>{const n=e.target,r=n.closest("[pond-router]");if(r){const e=r.getAttribute("pond-router"),o=n.getAttribute("pond-double-click");e&&o&&t.broadcastFrom(`event/${e}`,{type:o})}}))})(t,e)};window.addEventListener("popstate",(async()=>{await ke(location.pathname)}));const ke=async t=>{const e={"Content-Type":"text/html",Accept:"text/html","x-csrf-token":window.token,"x-router-request":"true",method:"GET"},n=await fetch(t,{headers:e}),r=n.headers;if(r.has("x-router-action")){const t=r.get("x-router-action");if(t){const e=r.get("x-router-path"),n=r.get("x-page-title");Ce(e,t,n)}}else{const t=r.get("x-router-container"),e=r.get("x-page-title"),o=await n.text();Pe(t,o,e)}},Te=t=>{t.delegateEvent("a","click",(async t=>{t.preventDefault();const e=t.target.href;await(async t=>{history.pushState(null,"",t),await ke(t)})(e)}))},Ce=(t,e,n)=>{switch(e){case"push":history.pushState(null,"",t);break;case"replace":history.replaceState(null,"",t);break;case"redirect":window.location.href=t}n&&(document.title=n)},Pe=(t,e,n)=>{const r=document.querySelector(t);if(r){const t=document.createElement("div");t.innerHTML=e;const o=t.firstElementChild,i=o.getAttribute("pond-router");i&&r.setAttribute("pond-router",i),Ee(r,o),n&&(document.title=n)}},De=(t,e)=>{((t,e)=>{e.addEventListener("[pond-keyup]","keyup",(e=>{const n=e.target,r=n.closest("[pond-router]");if(r){const e=r.getAttribute("pond-router"),o=n.getAttribute("pond-focus");e&&o&&t.broadcastFrom(`event/${e}`,{type:o})}}))})(t,e),((t,e)=>{e.addEventListener("[pond-keydown]","keydown",(e=>{const n=e.target,r=n.closest("[pond-router]");if(r){const e=r.getAttribute("pond-router"),o=n.getAttribute("pond-blur");e&&o&&t.broadcastFrom(`event/${e}`,{type:o})}}))})(t,e),((t,e)=>{e.addEventListener("[pond-keypress]","keypress",(e=>{const n=e.target,r=n.closest("[pond-router]");if(r){const e=r.getAttribute("pond-router"),o=n.getAttribute("pond-change");e&&o&&t.broadcastFrom(`event/${e}`,{type:o})}}))})(t,e)},Re=(t,e)=>{((t,e)=>{e.addEventListener("[pond-focus]","focus",(e=>{const n=e.target,r=n.closest("[pond-router]");if(r){const e=r.getAttribute("pond-router"),o=n.getAttribute("pond-focus");e&&o&&t.broadcastFrom(`event/${e}`,{type:o})}}))})(t,e),((t,e)=>{e.addEventListener("[pond-blur]","blur",(e=>{const n=e.target,r=n.closest("[pond-router]");if(r){const e=r.getAttribute("pond-router"),o=n.getAttribute("pond-blur");e&&o&&t.broadcastFrom(`event/${e}`,{type:o})}}))})(t,e),((t,e)=>{e.addEventListener("[pond-change]","change",(e=>{const n=e.target,r=n.closest("[pond-router]");if(r){const e=r.getAttribute("pond-router"),o=n.getAttribute("pond-change");e&&o&&t.broadcastFrom(`event/${e}`,{type:o})}}))})(t,e),((t,e)=>{e.addEventListener("[pond-input]","input",(e=>{const n=e.target,r=n.closest("[pond-router]");if(r){const e=r.getAttribute("pond-router"),o=n.getAttribute("pond-input");e&&o&&t.broadcastFrom(`event/${e}`,{type:o})}}))})(t,e),((t,e)=>{e.addEventListener("[pond-submit]","submit",(e=>{const n=e.target,r=n.closest("[pond-router]");if(r){const e=r.getAttribute("pond-router"),o=n.getAttribute("pond-submit");e&&o&&t.broadcastFrom(`event/${e}`,{type:o})}}))})(t,e)},je=()=>{const t=new he("/live");t.connect();const e=new Oe,n=t.createChannel(`/live/${window.token}`,{clientId:window.token});n.join(),n.onConnectionChange((t=>{t&&(xe(n,e),Ne(n,e),De(n,e),Re(n,e),Te(e))}))};window.addEventListener("load",(()=>{je()}))})();
//# sourceMappingURL=pondLive.js.map
